<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1591px" preserveAspectRatio="none" style="width:1396px;height:1591px;background:#FFFFFF;" version="1.1" viewBox="0 0 1396 1591" width="1396px" zoomAndPan="magnify"><defs><filter height="300%" id="fp4jir3sgaflf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1513.8828" style="stroke:#A80036;stroke-width:1.0;" width="1202" x="147" y="55.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="723" y="68.7139">Caliptra</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="44" x="1345" y="15.3809">Version 1</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="205" x="604" y="43.2637">Mix PMEK into MEK seed</text><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="1045.6563" style="stroke:#000000;stroke-width:2.0;" width="1353" x="8" y="374.9141"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="225.8125" style="stroke:#000000;stroke-width:2.0;" width="809" x="291" y="407.2656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="58" x2="58" y1="147.3984" y2="1491.2734"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="18" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="1473.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="186" x2="186" y1="147.3984" y2="1491.2734"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="43.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="181" y="332.5625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="307" x2="307" y1="147.3984" y2="1491.2734"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="1123.3594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="302" y="362.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="602" x2="602" y1="147.3984" y2="1491.2734"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="134.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="597" y="490.6719"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="134.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="597" y="745.4844"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="134.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="597" y="942.9453"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="164.7578" style="stroke:#A80036;stroke-width:1.0;" width="10" x="597" y="1140.4063"/><rect fill="#FFFFFF" filter="url(#fp4jir3sgaflf)" height="60.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="597" y="1351.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="836" x2="836" y1="147.3984" y2="1491.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="971.5" x2="971.5" y1="147.3984" y2="1491.2734"/><rect fill="#ADD8E6" filter="url(#fp4jir3sgaflf)" height="1181.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="966.5" y="310.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1084" x2="1084" y1="147.3984" y2="1491.2734"/><rect fill="#ADD8E6" filter="url(#fp4jir3sgaflf)" height="1181.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1079" y="310.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1189.5" x2="1189.5" y1="147.3984" y2="1491.2734"/><rect fill="#ADD8E6" filter="url(#fp4jir3sgaflf)" height="532.6797" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1184.5" y="849.5391"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1180.5" x2="1198.5" y1="1373.2188" y2="1391.2188"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1180.5" x2="1198.5" y1="1391.2188" y2="1373.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1296.5" x2="1296.5" y1="147.3984" y2="1491.2734"/><rect fill="#ADD8E6" filter="url(#fp4jir3sgaflf)" height="335.2188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1291.5" y="1047"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1287.5" x2="1305.5" y1="1373.2188" y2="1391.2188"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1287.5" x2="1305.5" y1="1391.2188" y2="1373.2188"/><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="64" x="24" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="31" y="97.1035">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="34.5" y="114.7129">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="45" y="132.3223">FW</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="66" x="151" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="158" y="132.3223">Mail Box</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="36" x="287" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="294" y="132.3223">FW</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="74" x="563" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="570" y="132.3223">Key Vault</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="136" x="766" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="804" y="97.1035">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="815.5" y="114.7129">Slot A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="773" y="132.3223">(Storage Root Key)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="107" x="916" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="939.5" y="97.1035">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="951" y="114.7129">Slot B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="923" y="132.3223">(PMEK Secret)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="90" x="1037" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1052" y="97.1035">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="1064" y="114.7129">Slot X</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="1044" y="132.3223">(MEK Seed)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="93" x="1141" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1157.5" y="97.1035">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="1169" y="114.7129">Slot Y</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1148" y="132.3223">(Temporary)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="93" x="1248" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1264.5" y="97.1035">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="1276.5" y="114.7129">Slot Z</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1255" y="132.3223">(Temporary)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="64" x="24" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="31" y="1512.8066">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="34.5" y="1530.416">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="45" y="1548.0254">FW</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="66" x="151" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="158" y="1512.8066">Mail Box</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="36" x="287" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="294" y="1512.8066">FW</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="74" x="563" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="570" y="1512.8066">Key Vault</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="136" x="766" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="804" y="1512.8066">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="815.5" y="1530.416">Slot A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="773" y="1548.0254">(Storage Root Key)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="107" x="916" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="939.5" y="1512.8066">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="951" y="1530.416">Slot B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="923" y="1548.0254">(PMEK Secret)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="90" x="1037" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1052" y="1512.8066">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="1064" y="1530.416">Slot X</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="1044" y="1548.0254">(MEK Seed)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="93" x="1141" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1157.5" y="1512.8066">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="1169" y="1530.416">Slot Y</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1148" y="1548.0254">(Temporary)</text><rect fill="#FEFECE" filter="url(#fp4jir3sgaflf)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="93" x="1248" y="1491.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1264.5" y="1512.8066">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="1276.5" y="1530.416">Slot Z</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1255" y="1548.0254">(Temporary)</text><path d="M10.25,160.3984 L10.25,300.3984 L1340.25,300.3984 L1340.25,170.3984 L1330.25,160.3984 L10.25,160.3984 " fill="#FBFB77" filter="url(#fp4jir3sgaflf)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1330.25,160.3984 L1330.25,170.3984 L1340.25,170.3984 L1330.25,160.3984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91" x="16.25" y="178.8936">Preconditions:</text><ellipse cx="21.75" cy="190.6016" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="29.25" y="195.2451">PMEK Secret is stored in Key Vault slot B</text><ellipse cx="21.75" cy="206.9531" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="506" x="29.25" y="211.5967">The following sequence has occurred prior: Initialize MEK then zero or more MIX_PMEK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="20.25" y="227.9482"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="16.25" y="244.2998">Notes:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="1301" x="24.25" y="260.6514">* The sequence diagram assumes that the KV will not allow an input KV slot to also be used as an out KV slot. Calitra FW is responsible for managing which KVC slots are used and can adapt if this assumption is not correct.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="535" x="24.25" y="277.0029">* This sequence is focused on successful execution of operations by the KV. Sill need to do:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="20.25" y="293.3545"/><line style="stroke:#008000;stroke-width:1.0;" x1="179" x2="169" y1="332.5625" y2="328.5625"/><line style="stroke:#008000;stroke-width:1.0;" x1="179" x2="169" y1="332.5625" y2="336.5625"/><line style="stroke:#008000;stroke-width:1.0;" x1="58" x2="180" y1="332.5625" y2="332.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="65" y="327.7061">[001]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="98" y="327.7061">MIX_PMEK</text><line style="stroke:#008000;stroke-width:1.0;" x1="300" x2="290" y1="362.9141" y2="358.9141"/><line style="stroke:#008000;stroke-width:1.0;" x1="300" x2="290" y1="362.9141" y2="366.9141"/><line style="stroke:#008000;stroke-width:1.0;" x1="191" x2="301" y1="362.9141" y2="362.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="198" y="358.0576">[002]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="231" y="358.0576">Command</text><path d="M8,374.9141 L69,374.9141 L69,382.9141 L59,392.9141 L8,392.9141 L8,374.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1045.6563" style="stroke:#000000;stroke-width:2.0;" width="1353" x="8" y="374.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="23" y="389.4092">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="139" x="84" y="388.333">[Storage Root Key exists]</text><path d="M291,407.2656 L352,407.2656 L352,415.2656 L342,425.2656 L291,425.2656 L291,407.2656 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="225.8125" style="stroke:#000000;stroke-width:2.0;" width="809" x="291" y="407.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="306" y="421.7607">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="324" x="367" y="420.6846">[MEK is not initialized (i.e., no PMEK has yet been included)]</text><polygon fill="#FF0000" points="585,486.6719,595,490.6719,585,494.6719,589,490.6719" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="312" x2="591" y1="490.6719" y2="490.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="319" y="469.4639">[003]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="352" y="453.1123">HMAC512(Key: Slot A,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="416" y="469.4639">Key Data: "MEK Seed",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="416" y="485.8154">Destination: Slot X)</text><polygon fill="#FF0000" points="824,517.0234,834,521.0234,824,525.0234,828,521.0234" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="830" y1="521.0234" y2="521.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="516.167">[004]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="647" y="516.167">Get Storage Root Key</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="649" y1="551.375" y2="551.375"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="649" x2="649" y1="551.375" y2="564.375"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="608" x2="649" y1="564.375" y2="564.375"/><polygon fill="#FF0000" points="618,560.375,608,564.375,618,568.375,614,564.375" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="546.5186">[005]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="647" y="546.5186">HMAC512 slot A with Data</text><polygon fill="#FF0000" points="1067,590.7266,1077,594.7266,1067,598.7266,1071,594.7266" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1073" y1="594.7266" y2="594.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="589.8701">[006]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="647" y="589.8701">HMAC512 result MEK Seed with Storage Root Key</text><polygon fill="#FF0000" points="323,621.0781,313,625.0781,323,629.0781,319,625.0781" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="317" x2="596" y1="625.0781" y2="625.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="329" y="620.2217">[007]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="362" y="620.2217">done</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="312" x2="354" y1="669.4297" y2="669.4297"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="354" x2="354" y1="669.4297" y2="682.4297"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="313" x2="354" y1="682.4297" y2="682.4297"/><polygon fill="#FF0000" points="323,678.4297,313,682.4297,323,686.4297,319,682.4297" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="319" y="664.5732">[008]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="352" y="664.5732">Determine Temporary slox Y for PMEK</text><polygon fill="#FF0000" points="585,741.4844,595,745.4844,585,749.4844,589,745.4844" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="312" x2="591" y1="745.4844" y2="745.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="319" y="724.2764">[009]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="352" y="707.9248">Key_Unwrap(Key:  SlotB,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="428" y="724.2764">Key Data: unlocked_pmek,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="428" y="740.6279">Destination Slot: Y)</text><polygon fill="#FF0000" points="954.5,771.8359,964.5,775.8359,954.5,779.8359,958.5,775.8359" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="960.5" y1="775.8359" y2="775.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="770.9795">[010]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="647" y="770.9795">Get PMEK secret</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="649" y1="806.1875" y2="806.1875"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="649" x2="649" y1="806.1875" y2="819.1875"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="608" x2="649" y1="819.1875" y2="819.1875"/><polygon fill="#FF0000" points="618,815.1875,608,819.1875,618,823.1875,614,819.1875" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="801.3311">[011]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="647" y="801.3311">Key_Unwrap unlocked_pmek</text><polygon fill="#FF0000" points="1172.5,845.5391,1182.5,849.5391,1172.5,853.5391,1176.5,849.5391" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1178.5" y1="849.5391" y2="849.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="844.6826">[012]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="647" y="844.6826">Put PMEK</text><polygon fill="#FF0000" points="323,875.8906,313,879.8906,323,883.8906,319,879.8906" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="317" x2="596" y1="879.8906" y2="879.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="329" y="875.0342">[013]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="362" y="875.0342">done</text><polygon fill="#FF0000" points="585,938.9453,595,942.9453,585,946.9453,589,942.9453" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="312" x2="591" y1="942.9453" y2="942.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="319" y="921.7373">[014]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="352" y="905.3857">HMAC512(Key : Slot X,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="416" y="921.7373">Data String : "PMEK mix",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="416" y="938.0889">Destination : Slot Z)</text><polygon fill="#FF0000" points="1067,969.2969,1077,973.2969,1067,977.2969,1071,973.2969" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1073" y1="973.2969" y2="973.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="968.4404">[015]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="647" y="968.4404">Get MEK Seed</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="649" y1="1003.6484" y2="1003.6484"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="649" x2="649" y1="1003.6484" y2="1016.6484"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="608" x2="649" y1="1016.6484" y2="1016.6484"/><polygon fill="#FF0000" points="618,1012.6484,608,1016.6484,618,1020.6484,614,1016.6484" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="998.792">[016]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="647" y="998.792">HMAC512 Key with Data String</text><polygon fill="#FF0000" points="1279.5,1043,1289.5,1047,1279.5,1051,1283.5,1047" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1285.5" y1="1047" y2="1047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="1042.1436">[017]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="647" y="1042.1436">HMAC512 result Temp MEK Seed</text><polygon fill="#FF0000" points="323,1073.3516,313,1077.3516,323,1081.3516,319,1077.3516" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="317" x2="596" y1="1077.3516" y2="1077.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="329" y="1072.4951">[018]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="362" y="1072.4951">done</text><polygon fill="#FF0000" points="585,1136.4063,595,1140.4063,585,1144.4063,589,1140.4063" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="312" x2="591" y1="1140.4063" y2="1140.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="319" y="1119.1982">[019]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="352" y="1102.8467">HMAC512_Slots(Key : Slot Z,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="452" y="1119.1982">Data Key  : Slot Y</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="452" y="1135.5498">Destination : Slot: X)</text><polygon fill="#FF0000" points="1279.5,1166.7578,1289.5,1170.7578,1279.5,1174.7578,1283.5,1170.7578" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1285.5" y1="1170.7578" y2="1170.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="1165.9014">[020]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="647" y="1165.9014">Get Temp MEK Seed</text><polygon fill="#FF0000" points="1172.5,1197.1094,1182.5,1201.1094,1172.5,1205.1094,1176.5,1201.1094" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1178.5" y1="1201.1094" y2="1201.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="1196.2529">[021]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="647" y="1196.2529">Get PMEK</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="649" y1="1231.4609" y2="1231.4609"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="649" x2="649" y1="1231.4609" y2="1244.4609"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="608" x2="649" y1="1244.4609" y2="1244.4609"/><polygon fill="#FF0000" points="618,1240.4609,608,1244.4609,618,1248.4609,614,1244.4609" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="1226.6045">[022]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="647" y="1226.6045">HMAC512 Key and Data Key</text><polygon fill="#FF0000" points="1067,1270.8125,1077,1274.8125,1067,1278.8125,1071,1274.8125" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1073" y1="1274.8125" y2="1274.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="1269.9561">[023]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="647" y="1269.9561">HMAC512 result MEK Seed updated with PMEK</text><polygon fill="#FF0000" points="323,1301.1641,313,1305.1641,323,1309.1641,319,1305.1641" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="317" x2="596" y1="1305.1641" y2="1305.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="329" y="1300.3076">[024]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="362" y="1300.3076">done</text><polygon fill="#FF0000" points="585,1347.8672,595,1351.8672,585,1355.8672,589,1351.8672" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="312" x2="591" y1="1351.8672" y2="1351.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="319" y="1338.835">[025]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="352" y="1330.6592">Purge_key(Key: Slot Y,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="416" y="1347.0107">Key : Slot Z)</text><polygon fill="#FF0000" points="1172.5,1378.2188,1182.5,1382.2188,1172.5,1386.2188,1176.5,1382.2188" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1178.5" y1="1382.2188" y2="1382.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="1377.3623">[026]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="647" y="1377.3623">Purge</text><polygon fill="#FF0000" points="1279.5,1378.2188,1289.5,1382.2188,1279.5,1386.2188,1283.5,1382.2188" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="607" x2="1285.5" y1="1382.2188" y2="1382.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="614" y="1377.3623">[027]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="651" y="1377.3623"/><polygon fill="#FF0000" points="323,1408.5703,313,1412.5703,323,1416.5703,319,1412.5703" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="317" x2="596" y1="1412.5703" y2="1412.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="329" y="1407.7139">[028]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="362" y="1407.7139">done</text><line style="stroke:#008000;stroke-width:1.0;" x1="186" x2="196" y1="1473.2734" y2="1469.2734"/><line style="stroke:#008000;stroke-width:1.0;" x1="186" x2="196" y1="1473.2734" y2="1477.2734"/><line style="stroke:#008000;stroke-width:1.0;" x1="186" x2="301" y1="1473.2734" y2="1473.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="203" y="1460.2412">[029]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="236" y="1452.0654">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="236" y="1468.417">response</text><line style="stroke:#008000;stroke-width:1.0;" x1="63" x2="73" y1="1473.2734" y2="1469.2734"/><line style="stroke:#008000;stroke-width:1.0;" x1="63" x2="73" y1="1473.2734" y2="1477.2734"/><line style="stroke:#008000;stroke-width:1.0;" x1="63" x2="185" y1="1473.2734" y2="1473.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="80" y="1460.2412">[030]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="113" y="1452.0654">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="113" y="1468.417">complete</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="141" x="636" y="1583.4824">Filename: include_pmec.uml</text><!--MD5=[541f366618c398278603a9bdb1f1077f]
@startuml

!include ocp_lock_utils.inc

!if ($show_title)
    Title "Mix PMEK into MEK seed"
!endif

!if ($show_precond)
    note across
        <b>Preconditions:</b>
        * PMEK Secret is stored in Key Vault slot B
        * The following sequence has occurred prior: Initialize MEK then zero or more MIX_PMEK

        <b>Notes:</b>
          * The sequence diagram assumes that the KV will not allow an input KV slot to also be used as an out KV slot. Calitra FW is responsible for managing which KVC slots are used and can adapt if this assumption is not correct.
          * This sequence is focused on successful execution of operations by the KV. Sill need to do:

    end note
!endif

' Pre-existing data
meks++ $BUFFER_ACTIVATION
pmeks++ $BUFFER_ACTIVATION


fw $async mb++ : MIX_PMEK

!if ($show_api)
    note right mb
        | <b>Field      | <b>Size        | <b>Definition |
        | chksum        | u32            | Little endian |
        | unlocked_pmek | 512 bytes | Unlocked encrypted PMEK\n * PMEK Algorithm embedded |
    end note
!endif

mb $async cfw++ : Command

!if ($show_msg_parsing)
    cfw $sync mb : Get command
    mb- -
    $self("cfw", "Determine command")
!else
    mb- -
!endif

alt Storage Root Key exists

    alt MEK is not initialized (i.e., no PMEK has yet been included)
        cfw $sync kv++: HMAC512(Key: Slot A,\n                Key Data: "MEK Seed",\n                Destination: Slot X)
        kv $sync srk: Get Storage Root Key
        kv $sync kv: HMAC512 slot A with Data
        kv $sync meks: HMAC512 result MEK Seed with Storage Root Key
        !if ($show_done)
            kv $sync cfw- - : done
        !else
            kv- -
        !endif
    end

    $self("cfw", "Determine Temporary slox Y for PMEK")

    cfw $sync kv++: Key_Unwrap(Key:  SlotB,\n                   Key Data: unlocked_pmek,\n                   Destination Slot: Y)
    kv $sync pmeks: Get PMEK secret
    kv $sync kv: Key_Unwrap unlocked_pmek
    kv $sync tempy: Put PMEK
    tempy++ $BUFFER_ACTIVATION
    !if ($show_done)
        kv $sync cfw- - : done
    !else
        kv- -
    !endif

    cfw $sync kv++: HMAC512(Key : Slot X,\n                Data String : "PMEK mix",\n                Destination : Slot Z)
    kv $sync meks: Get MEK Seed
    kv $sync kv: HMAC512 Key with Data String
    kv $sync tempz: HMAC512 result Temp MEK Seed
    tempz++ $BUFFER_ACTIVATION
    !if ($show_done)
        kv $sync cfw- - : done
    !else
        kv- -
    !endif

    cfw $sync kv++: HMAC512_Slots(Key : Slot Z,\n                         Data Key  : Slot Y\n                         Destination : Slot: X)
    kv $sync tempz: Get Temp MEK Seed
    kv $sync tempy: Get PMEK
    kv $sync kv: HMAC512 Key and Data Key
    kv $sync meks: HMAC512 result MEK Seed updated with PMEK
    !if ($show_done)
        kv $sync cfw- - : done
    !else
        kv- -
    !endif

    cfw $sync kv++: Purge_key(Key: Slot Y,\n                Key : Slot Z)
    kv $sync tempy !! : Purge
    & kv $sync tempz !!
    !if ($show_done)
        kv $sync cfw- - : done
    !else
        kv- -
    !endif
end


cfw $async mb : Command\nresponse
& mb $async fw++ : Command\ncomplete

!if ($show_api)
    note right mb
        | <b>Field   | <b>Size | <b>Definition |
        | chksum     | u32     | Little endian |
        | fips_status| u32     | Indicates if the command is FIPS approved or an error |
    end note
!endif
cfw- -

@enduml

@startuml









	autonumber 1 1  "<b>[000]"

	!pragma teoz true

    participant "Remote Key\nManagement Service" as rkms


    participant "Host" as host


    participant "Storage\nDevice\nFW" as fw

    box "Caliptra"
    	participant "Mail Box" as mb
    	participant "ROM" as crom
    	participant "FW" as cfw
    	participant "ROM to FW\nHandoff Data" as hoff
        participant "DRBG" as rand
        participant "DMA Engine" as dma
        participant "Key Vault" as kv
        participant "Key Vault\nFuses" as fuses
        participant "Key Vault\nStorage Root Key" as gsrk
        participant "Key Vault\nSlot A\n(Storage Root Key)" as srk
        participant "Key Vault\nSlot B\n(PMEK Secret)" as pmeks
        participant "Key Vault\nSlot F\n(DICE Alias Key)\necdsa_secp384r1_sha384" as dice
        participant "Key Vault\nSlot G\n(KEM Keypair)" as kemg
        participant "Key Vault\nSlot W\n(Temporary)" as tempw
        participant "Key Vault\nSlot X\n(MEK Seed)" as meks
        participant "Key Vault\nSlot Y\n(Temporary)" as tempy
        participant "Key Vault\nSlot Z\n(Temporary)" as tempz
        participant "Key Vault\nTemp Memory" as tempmem
    end box

    box "Encryption Engine"
        participant "SFR\nInterface" as sfr
        participant "Control" as ee
        participant "Key Cache" as kc
    end box

    box "Media"
        participant "Create new\Storage Root Key\non NVM subsystem reset" as csrk
        participant "Destroy all\Storage Root Keys\non NVM subsystem reset" as dsrk
    end box

    hide unlinked
	footer Filename: include_pmec.uml

	header Version 1


    Title "Mix PMEK into MEK seed"

    note across
        <b>Preconditions:</b>
        * PMEK Secret is stored in Key Vault slot B
        * The following sequence has occurred prior: Initialize MEK then zero or more MIX_PMEK

        <b>Notes:</b>
          * The sequence diagram assumes that the KV will not allow an input KV slot to also be used as an out KV slot. Calitra FW is responsible for managing which KVC slots are used and can adapt if this assumption is not correct.
          * This sequence is focused on successful execution of operations by the KV. Sill need to do:

    end note

meks++ #lightblue
pmeks++ #lightblue


fw -[#green]>> mb++ : MIX_PMEK


mb -[#green]>> cfw++ : Command

    mb- -

alt Storage Root Key exists

    alt MEK is not initialized (i.e., no PMEK has yet been included)
        cfw -[#red]> kv++: HMAC512(Key: Slot A,\n                Key Data: "MEK Seed",\n                Destination: Slot X)
        kv -[#red]> srk: Get Storage Root Key
        kv -[#red]> kv: HMAC512 slot A with Data
        kv -[#red]> meks: HMAC512 result MEK Seed with Storage Root Key
            kv -[#red]> cfw- - : done
    end

    	   cfw -[#red]> cfw : Determine Temporary slox Y for PMEK
	   ||0||

    cfw -[#red]> kv++: Key_Unwrap(Key:  SlotB,\n                   Key Data: unlocked_pmek,\n                   Destination Slot: Y)
    kv -[#red]> pmeks: Get PMEK secret
    kv -[#red]> kv: Key_Unwrap unlocked_pmek
    kv -[#red]> tempy: Put PMEK
    tempy++ #lightblue
        kv -[#red]> cfw- - : done

    cfw -[#red]> kv++: HMAC512(Key : Slot X,\n                Data String : "PMEK mix",\n                Destination : Slot Z)
    kv -[#red]> meks: Get MEK Seed
    kv -[#red]> kv: HMAC512 Key with Data String
    kv -[#red]> tempz: HMAC512 result Temp MEK Seed
    tempz++ #lightblue
        kv -[#red]> cfw- - : done

    cfw -[#red]> kv++: HMAC512_Slots(Key : Slot Z,\n                         Data Key  : Slot Y\n                         Destination : Slot: X)
    kv -[#red]> tempz: Get Temp MEK Seed
    kv -[#red]> tempy: Get PMEK
    kv -[#red]> kv: HMAC512 Key and Data Key
    kv -[#red]> meks: HMAC512 result MEK Seed updated with PMEK
        kv -[#red]> cfw- - : done

    cfw -[#red]> kv++: Purge_key(Key: Slot Y,\n                Key : Slot Z)
    kv -[#red]> tempy !! : Purge
    & kv -[#red]> tempz !!
        kv -[#red]> cfw- - : done
end


cfw -[#green]>> mb : Command\nresponse
& mb -[#green]>> fw++ : Command\ncomplete

cfw- -

@enduml

PlantUML version 1.2021.7(Sun May 23 06:40:07 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>