<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1111px" preserveAspectRatio="none" style="width:1210px;height:1111px;background:#FFFFFF;" version="1.1" viewBox="0 0 1210 1111" width="1210px" zoomAndPan="magnify"><defs><filter height="300%" id="fjnnu295achrb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1033.8516" style="stroke:#A80036;stroke-width:1.0;" width="251" x="151" y="55.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="251.5" y="68.7139">Caliptra</text><rect fill="#DDDDDD" height="1033.8516" style="stroke:#A80036;stroke-width:1.0;" width="377" x="735.5" y="55.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="866.5" y="68.7139">Encryption Engine</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="44" x="1159" y="15.3809">Version 1</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="101" x="553.5" y="43.2637">Unload MEK</text><rect fill="#FFFFFF" filter="url(#fjnnu295achrb)" height="209.1094" style="stroke:#000000;stroke-width:2.0;" width="515" x="343" y="307.1563"/><rect fill="#FFFFFF" filter="url(#fjnnu295achrb)" height="58.7031" style="stroke:#000000;stroke-width:2.0;" width="471" x="362" y="443.5625"/><rect fill="#FFFFFF" filter="url(#fjnnu295achrb)" height="138.1094" style="stroke:#000000;stroke-width:2.0;" width="627" x="362" y="729.375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="39" x2="39" y1="147.3984" y2="1011.2422"/><rect fill="#FFFFFF" filter="url(#fjnnu295achrb)" height="50.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="34" y="960.5391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="190" x2="190" y1="147.3984" y2="1011.2422"/><rect fill="#FFFFFF" filter="url(#fjnnu295achrb)" height="43.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="185" y="234.4531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="378" x2="378" y1="147.3984" y2="1011.2422"/><rect fill="#FFFFFF" filter="url(#fjnnu295achrb)" height="741.4375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="373" y="264.8047"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="776" x2="776" y1="147.3984" y2="1011.2422"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="941" x2="941" y1="147.3984" y2="1011.2422"/><rect fill="#FFFFFF" filter="url(#fjnnu295achrb)" height="246.1641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="936" y="582.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1065" x2="1065" y1="147.3984" y2="1011.2422"/><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="64" x="5" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="12" y="97.1035">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="15.5" y="114.7129">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="26" y="132.3223">FW</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="66" x="155" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="162" y="132.3223">Mail Box</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="36" x="358" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="365" y="132.3223">FW</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="49.2188" style="stroke:#A80036;stroke-width:1.5;" width="69" x="739.5" y="93.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="760" y="114.7129">SFR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="746.5" y="132.3223">Interface</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="60" x="909" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="916" y="132.3223">Control</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="83" x="1021.5" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="1028.5" y="132.3223">Key Cache</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="64" x="5" y="1011.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="12" y="1032.7754">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="15.5" y="1050.3848">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="26" y="1067.9941">FW</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="66" x="155" y="1011.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="162" y="1032.7754">Mail Box</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="36" x="358" y="1011.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="365" y="1032.7754">FW</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="49.2188" style="stroke:#A80036;stroke-width:1.5;" width="69" x="739.5" y="1011.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="760" y="1032.7754">SFR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="746.5" y="1050.3848">Interface</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="60" x="909" y="1011.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="916" y="1032.7754">Control</text><rect fill="#FEFECE" filter="url(#fjnnu295achrb)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="83" x="1021.5" y="1011.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="1028.5" y="1032.7754">Key Cache</text><path d="M5.25,160.3984 L5.25,202.3984 L1098.25,202.3984 L1098.25,170.3984 L1088.25,160.3984 L5.25,160.3984 " fill="#FBFB77" filter="url(#fjnnu295achrb)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1088.25,160.3984 L1088.25,170.3984 L1098.25,170.3984 L1088.25,160.3984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91" x="396.5" y="178.8936">Preconditions:</text><ellipse cx="402" cy="190.6016" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="409.5" y="195.2451">None - a MEK may or may not have been loaded.</text><line style="stroke:#008000;stroke-width:1.0;" x1="183" x2="173" y1="234.4531" y2="230.4531"/><line style="stroke:#008000;stroke-width:1.0;" x1="183" x2="173" y1="234.4531" y2="238.4531"/><line style="stroke:#008000;stroke-width:1.0;" x1="39" x2="184" y1="234.4531" y2="234.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="46" y="229.5967">[001]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="79" y="229.5967">UNLOAD_MEK</text><line style="stroke:#008000;stroke-width:1.0;" x1="371" x2="361" y1="264.8047" y2="260.8047"/><line style="stroke:#008000;stroke-width:1.0;" x1="371" x2="361" y1="264.8047" y2="268.8047"/><line style="stroke:#008000;stroke-width:1.0;" x1="195" x2="372" y1="264.8047" y2="264.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="202" y="259.9482">[002]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="235" y="259.9482">Command</text><polygon fill="#FF0000" points="764,291.1563,774,295.1563,764,299.1563,768,295.1563" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="295.1563" y2="295.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="290.2998">[003]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="423" y="290.2998">Read Control Reg</text><path d="M343,307.1563 L404,307.1563 L404,315.1563 L394,325.1563 L343,325.1563 L343,307.1563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="209.1094" style="stroke:#000000;stroke-width:2.0;" width="515" x="343" y="307.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="358" y="321.6514">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="186" x="419" y="320.5752">[(DN == 1b || ERR == 1b || EXE == 1b)]</text><polygon fill="#FF0000" points="764,353.8594,774,357.8594,764,361.8594,768,357.8594" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="357.8594" y2="357.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="353.0029">[004]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="423" y="353.0029">Write Control Reg (DN = 1b)</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="425" y1="388.2109" y2="388.2109"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="425" x2="425" y1="388.2109" y2="401.2109"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="384" x2="425" y1="401.2109" y2="401.2109"/><polygon fill="#FF0000" points="394,397.2109,384,401.2109,394,405.2109,390,401.2109" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="383.3545">[005]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="423" y="383.3545">Start timeout</text><polygon fill="#FF0000" points="764,427.5625,774,431.5625,764,435.5625,768,431.5625" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="431.5625" y2="431.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="426.7061">[006]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="423" y="426.7061">Read Control Reg</text><path d="M362,443.5625 L817,443.5625 L817,451.5625 L807,461.5625 L362,461.5625 L362,443.5625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="58.7031" style="stroke:#000000;stroke-width:2.0;" width="471" x="362" y="443.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="410" x="377" y="458.0576">loop until (rdy_timeout or (DN == 0b &amp;&amp; ERR == 0b &amp;&amp; EXE == 0b)</text><polygon fill="#FF0000" points="764,490.2656,774,494.2656,764,498.2656,768,494.2656" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="494.2656" y2="494.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="489.4092">[007]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="423" y="489.4092">Read Control Reg</text><polygon fill="#FF0000" points="764,548.6172,774,552.6172,764,556.6172,768,552.6172" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="552.6172" y2="552.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="547.7607">[008]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="423" y="547.7607">Write Metadata</text><polygon fill="#FF0000" points="764,578.9688,774,582.9688,764,586.9688,768,582.9688" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="582.9688" y2="582.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="578.1123">[009]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="423" y="578.1123">Write Control Reg (CMD = Unload_MEK, DN = 0, EXE = 1)</text><line style="stroke:#008000;stroke-width:1.0;" x1="934" x2="924" y1="582.9688" y2="578.9688"/><line style="stroke:#008000;stroke-width:1.0;" x1="934" x2="924" y1="582.9688" y2="586.9688"/><line style="stroke:#008000;stroke-width:1.0;" x1="776" x2="935" y1="582.9688" y2="582.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="783" y="578.1123">[010]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="820" y="578.1123"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="425" y1="613.3203" y2="613.3203"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="425" x2="425" y1="613.3203" y2="626.3203"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="384" x2="425" y1="626.3203" y2="626.3203"/><polygon fill="#FF0000" points="394,622.3203,384,626.3203,394,630.3203,390,626.3203" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="608.4639">[011]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="423" y="608.4639">Start timeout</text><polygon fill="#FF0000" points="764,652.6719,774,656.6719,764,660.6719,768,656.6719" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="656.6719" y2="656.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="651.8154">[012]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="423" y="651.8154">Read Control Reg</text><polygon fill="#FF0000" points="787,683.0234,777,687.0234,787,691.0234,783,687.0234" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="781" x2="935" y1="687.0234" y2="687.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="793" y="682.167">[013]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="826" y="682.167">Read Metadata</text><polygon fill="#FF0000" points="1053,713.375,1063,717.375,1053,721.375,1057,717.375" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="946" x2="1059" y1="717.375" y2="717.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="953" y="712.5186">[014]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="986" y="712.5186">Unload Key</text><path d="M362,729.375 L631,729.375 L631,737.375 L621,747.375 L362,747.375 L362,729.375 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="138.1094" style="stroke:#000000;stroke-width:2.0;" width="627" x="362" y="729.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="224" x="377" y="743.8701">loop until (cmd_timeout or DN = 1b)</text><line style="stroke:#008000;stroke-width:1.0;" x1="776" x2="786" y1="829.1328" y2="825.1328"/><line style="stroke:#008000;stroke-width:1.0;" x1="776" x2="786" y1="829.1328" y2="833.1328"/><line style="stroke:#008000;stroke-width:1.0;" x1="776" x2="935" y1="829.1328" y2="829.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="793" y="799.749">[015]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="826" y="775.2217">Write Control Reg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="826" y="791.5732">(DN = 1b,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="830" y="807.9248">ERR = 0b,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="830" y="824.2764">EXE = 0b)</text><polygon fill="#FF0000" points="764,855.4844,774,859.4844,764,863.4844,768,859.4844" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="859.4844" y2="859.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="854.6279">[016]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="423" y="854.6279">Read Control Reg</text><polygon fill="#FF0000" points="764,899.8359,774,903.8359,764,907.8359,768,903.8359" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="383" x2="770" y1="903.8359" y2="903.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="390" y="898.9795">[017]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="423" y="898.9795">Write Control Reg (DN = 1b)</text><path d="M781,886.4844 L781,912.4844 L1194,912.4844 L1194,896.4844 L1184,886.4844 L781,886.4844 " fill="#FBFB77" filter="url(#fjnnu295achrb)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1184,886.4844 L1184,896.4844 L1194,896.4844 L1184,886.4844 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="392" x="787" y="904.9795">Reset the SFR interface for next operation - not waiting for response</text><polygon fill="#FF0000" points="201,989.2422,191,993.2422,201,997.2422,197,993.2422" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="195" x2="372" y1="993.2422" y2="993.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="207" y="963.8584">[018]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="240" y="939.3311">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="240" y="955.6826">response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="240" y="972.0342">(Status = Control Reg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="300" y="988.3857">Error field)</text><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="54" y1="993.2422" y2="989.2422"/><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="54" y1="993.2422" y2="997.2422"/><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="189" y1="993.2422" y2="993.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="61" y="980.21">[019]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="94" y="972.0342">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="94" y="988.3857">complete</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="130" x="539" y="1103.4512">Filename: unload_mek.uml</text><!--MD5=[90352872a29125b452769510898a7ae1]
@startuml

!include ocp_lock_utils.inc

!if ($show_title)
    Title "Unload MEK"
!endif

!if ($show_precond)
    note across
        <b>Preconditions:</b>
        * None - a MEK may or may not have been loaded.
    end note
!endif


fw $async mb++ : UNLOAD_MEK

    !if ($show_api)
        note right mb
            | Field        | Size  | Definition |
            | chksum       | u32   | Little endian |
            | metadata     | u8[20] | Metadata for MEK to load into the drive crypto engine (i.e. NSID + LBA range) |
            | rdy_timeout  | u32   | Timeout in ms for encryption engine to become ready for a new command |
            | cmd_timeout  | u32   | Timeout in ms for command to crypto engine to complete |
        end note
    !endif

mb $async cfw++ : Command

!if ($show_msg_parsing)
    cfw $sync mb : Get command
    mb- -
    $self("cfw", "Determine command")
!else
    mb- -
!endif

cfw $sync sfr : Read Control Reg

alt (DN == 1b || ERR == 1b || EXE == 1b)
    cfw $sync sfr : Write Control Reg (DN = 1b)

    cfw $sync cfw : Start timeout
    cfw $sync sfr : Read Control Reg
    group loop until (rdy_timeout or (DN == 0b && ERR == 0b && EXE == 0b)

        cfw $sync sfr : Read Control Reg
    end
end

sfr- -
cfw $sync sfr : Write Metadata

cfw $sync sfr : Write Control Reg (CMD = Unload_MEK, DN = 0, EXE = 1)
& sfr $async ee++

cfw $sync cfw : Start timeout

cfw $sync sfr : Read Control Reg

ee $sync sfr : Read Metadata
ee $sync kc : Unload Key

group loop until (cmd_timeout or DN = 1b)


    ee $async sfr- - : Write Control Reg\n(DN = 1b,\n ERR = 0b,\n EXE = 0b)
    cfw $sync sfr : Read Control Reg
end
sfr- -

cfw $sync sfr : Write Control Reg (DN = 1b)
note right: Reset the SFR interface for next operation - not waiting for response


cfw $sync mb : Command\nresponse\n(Status = Control Reg\n               Error field)
& mb $async fw++ : Command\ncomplete
cfw- -

    !if ($show_api)
        note right mb
            | <b>Field    | <b>Size | <b>Definition |
            | chksum      | u32     | Little endian |
            | fips_status | u32     | Indicates if the command is FIPS approved or an error |
        end note
    !endif

@enduml

@startuml









	autonumber 1 1  "<b>[000]"

	!pragma teoz true

    participant "Remote Key\nManagement Service" as rkms


    participant "Host" as host


    participant "Storage\nDevice\nFW" as fw

    box "Caliptra"
    	participant "Mail Box" as mb
    	participant "ROM" as crom
    	participant "FW" as cfw
    	participant "ROM to FW\nHandoff Data" as hoff
        participant "DRBG" as rand
        participant "DMA Engine" as dma
        participant "Key Vault" as kv
        participant "Key Vault\nFuses" as fuses
        participant "Key Vault\nStorage Root Key" as gsrk
        participant "Key Vault\nSlot A\n(Storage Root Key)" as srk
        participant "Key Vault\nSlot B\n(PMEK Secret)" as pmeks
        participant "Key Vault\nSlot F\n(DICE Alias Key)\necdsa_secp384r1_sha384" as dice
        participant "Key Vault\nSlot G\n(KEM Keypair)" as kemg
        participant "Key Vault\nSlot W\n(Temporary)" as tempw
        participant "Key Vault\nSlot X\n(MEK Seed)" as meks
        participant "Key Vault\nSlot Y\n(Temporary)" as tempy
        participant "Key Vault\nSlot Z\n(Temporary)" as tempz
        participant "Key Vault\nTemp Memory" as tempmem
    end box

    box "Encryption Engine"
        participant "SFR\nInterface" as sfr
        participant "Control" as ee
        participant "Key Cache" as kc
    end box

    box "Media"
        participant "Create new\Storage Root Key\non NVM subsystem reset" as csrk
        participant "Destroy all\Storage Root Keys\non NVM subsystem reset" as dsrk
    end box

    hide unlinked
	footer Filename: unload_mek.uml

	header Version 1


    Title "Unload MEK"

    note across
        <b>Preconditions:</b>
        * None - a MEK may or may not have been loaded.
    end note


fw -[#green]>> mb++ : UNLOAD_MEK


mb -[#green]>> cfw++ : Command

    mb- -

cfw -[#red]> sfr : Read Control Reg

alt (DN == 1b || ERR == 1b || EXE == 1b)
    cfw -[#red]> sfr : Write Control Reg (DN = 1b)

    cfw -[#red]> cfw : Start timeout
    cfw -[#red]> sfr : Read Control Reg
    group loop until (rdy_timeout or (DN == 0b && ERR == 0b && EXE == 0b)

        cfw -[#red]> sfr : Read Control Reg
    end
end

sfr- -
cfw -[#red]> sfr : Write Metadata

cfw -[#red]> sfr : Write Control Reg (CMD = Unload_MEK, DN = 0, EXE = 1)
& sfr -[#green]>> ee++

cfw -[#red]> cfw : Start timeout

cfw -[#red]> sfr : Read Control Reg

ee -[#red]> sfr : Read Metadata
ee -[#red]> kc : Unload Key

group loop until (cmd_timeout or DN = 1b)


    ee -[#green]>> sfr- - : Write Control Reg\n(DN = 1b,\n ERR = 0b,\n EXE = 0b)
    cfw -[#red]> sfr : Read Control Reg
end
sfr- -

cfw -[#red]> sfr : Write Control Reg (DN = 1b)
note right: Reset the SFR interface for next operation - not waiting for response


cfw -[#red]> mb : Command\nresponse\n(Status = Control Reg\n               Error field)
& mb -[#green]>> fw++ : Command\ncomplete
cfw- -


@enduml

PlantUML version 1.2021.7(Sun May 23 06:40:07 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>