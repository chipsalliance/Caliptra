<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1144px" preserveAspectRatio="none" style="width:1050px;height:1144px;background:#FFFFFF;" version="1.1" viewBox="0 0 1050 1144" width="1050px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ccu3907bzaot" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1066.2031" style="stroke:#A80036;stroke-width:1.0;" width="184" x="191" y="55.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="258" y="68.7139">Caliptra</text><rect fill="#DDDDDD" height="1066.2031" style="stroke:#A80036;stroke-width:1.0;" width="344" x="693.5" y="55.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="808" y="68.7139">Encryption Engine</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="44" x="999.5" y="15.3809">Version 1</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="359" x="344.75" y="43.2637">Clear the key cache in the Encryption Engine</text><rect fill="#FFFFFF" filter="url(#f1ccu3907bzaot)" height="647.0313" style="stroke:#000000;stroke-width:2.0;" width="715" x="291" y="325.8594"/><rect fill="#FFFFFF" filter="url(#f1ccu3907bzaot)" height="209.1094" style="stroke:#000000;stroke-width:2.0;" width="515" x="316" y="388.5625"/><rect fill="#FFFFFF" filter="url(#f1ccu3907bzaot)" height="58.7031" style="stroke:#000000;stroke-width:2.0;" width="471" x="335" y="524.9688"/><rect fill="#FFFFFF" filter="url(#f1ccu3907bzaot)" height="138.1094" style="stroke:#000000;stroke-width:2.0;" width="612" x="335" y="750.0781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="39" x2="39" y1="147.3984" y2="1043.5938"/><rect fill="#FFFFFF" filter="url(#f1ccu3907bzaot)" height="18" style="stroke:#A80036;stroke-width:1.0;" width="10" x="34" y="1025.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="230" x2="230" y1="147.3984" y2="1043.5938"/><rect fill="#FFFFFF" filter="url(#f1ccu3907bzaot)" height="43.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="225" y="283.5078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="351" x2="351" y1="147.3984" y2="1043.5938"/><rect fill="#FFFFFF" filter="url(#f1ccu3907bzaot)" height="724.7344" style="stroke:#A80036;stroke-width:1.0;" width="10" x="346" y="313.8594"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="734" x2="734" y1="147.3984" y2="1043.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="899" x2="899" y1="147.3984" y2="1043.5938"/><rect fill="#FFFFFF" filter="url(#f1ccu3907bzaot)" height="246.1641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="894" y="634.0234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="990" x2="990" y1="147.3984" y2="1043.5938"/><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="64" x="5" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="12" y="97.1035">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="15.5" y="114.7129">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="26" y="132.3223">FW</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="66" x="195" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="202" y="132.3223">Mail Box</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="36" x="331" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="338" y="132.3223">FW</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="49.2188" style="stroke:#A80036;stroke-width:1.5;" width="69" x="697.5" y="93.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="718" y="114.7129">SFR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="704.5" y="132.3223">Interface</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="60" x="867" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="874" y="132.3223">Control</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="83" x="946.5" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="953.5" y="132.3223">Key Cache</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="64" x="5" y="1043.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="12" y="1065.127">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="15.5" y="1082.7363">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="26" y="1100.3457">FW</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="66" x="195" y="1043.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="202" y="1065.127">Mail Box</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="36" x="331" y="1043.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="338" y="1065.127">FW</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="49.2188" style="stroke:#A80036;stroke-width:1.5;" width="69" x="697.5" y="1043.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="718" y="1065.127">SFR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="704.5" y="1082.7363">Interface</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="60" x="867" y="1043.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="874" y="1065.127">Control</text><rect fill="#FEFECE" filter="url(#f1ccu3907bzaot)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="83" x="946.5" y="1043.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="953.5" y="1065.127">Key Cache</text><path d="M5.25,160.3984 L5.25,251.3984 L1023.25,251.3984 L1023.25,170.3984 L1013.25,160.3984 L5.25,160.3984 " fill="#FBFB77" filter="url(#f1ccu3907bzaot)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1013.25,160.3984 L1013.25,170.3984 L1023.25,170.3984 L1013.25,160.3984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91" x="163" y="178.8936">Preconditions:</text><ellipse cx="168.5" cy="190.6016" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="435" x="176" y="195.2451">Keys may or may not be loaded in the Key Cache of the Encryption Engine</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="167" y="211.5967"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="163" y="227.9482">Notes:</text><ellipse cx="168.5" cy="239.6563" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="677" x="176" y="244.2998">This sequence diagram is not showing any error reporting due to timeouts or errors reported by the Encryption Engine</text><line style="stroke:#008000;stroke-width:1.0;" x1="223" x2="213" y1="283.5078" y2="279.5078"/><line style="stroke:#008000;stroke-width:1.0;" x1="223" x2="213" y1="283.5078" y2="287.5078"/><line style="stroke:#008000;stroke-width:1.0;" x1="39" x2="224" y1="283.5078" y2="283.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="46" y="278.6514">[001]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="79" y="278.6514">CLEAR_KEY_CACHE</text><line style="stroke:#008000;stroke-width:1.0;" x1="344" x2="334" y1="313.8594" y2="309.8594"/><line style="stroke:#008000;stroke-width:1.0;" x1="344" x2="334" y1="313.8594" y2="317.8594"/><line style="stroke:#008000;stroke-width:1.0;" x1="235" x2="345" y1="313.8594" y2="313.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="242" y="309.0029">[002]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="275" y="309.0029">Command</text><path d="M291,325.8594 L352,325.8594 L352,333.8594 L342,343.8594 L291,343.8594 L291,325.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="647.0313" style="stroke:#000000;stroke-width:2.0;" width="715" x="291" y="325.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="306" y="340.3545">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="204" x="367" y="339.2783">[Encryption Engin has become ready]</text><polygon fill="#FF0000" points="722,372.5625,732,376.5625,722,380.5625,726,376.5625" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="728" y1="376.5625" y2="376.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="371.7061">[003]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="396" y="371.7061">Read Control Reg</text><path d="M316,388.5625 L377,388.5625 L377,396.5625 L367,406.5625 L316,406.5625 L316,388.5625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="209.1094" style="stroke:#000000;stroke-width:2.0;" width="515" x="316" y="388.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="331" y="403.0576">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="186" x="392" y="401.9814">[(DN == 1b || ERR == 1b || EXE == 1b)]</text><polygon fill="#FF0000" points="722,435.2656,732,439.2656,722,443.2656,726,439.2656" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="728" y1="439.2656" y2="439.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="434.4092">[004]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="396" y="434.4092">Write Control Reg (DN = 1b)</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="398" y1="469.6172" y2="469.6172"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="398" x2="398" y1="469.6172" y2="482.6172"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="357" x2="398" y1="482.6172" y2="482.6172"/><polygon fill="#FF0000" points="367,478.6172,357,482.6172,367,486.6172,363,482.6172" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="464.7607">[005]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="396" y="464.7607">Start timeout</text><polygon fill="#FF0000" points="722,508.9688,732,512.9688,722,516.9688,726,512.9688" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="728" y1="512.9688" y2="512.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="508.1123">[006]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="396" y="508.1123">Read Control Reg</text><path d="M335,524.9688 L790,524.9688 L790,532.9688 L780,542.9688 L335,542.9688 L335,524.9688 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="58.7031" style="stroke:#000000;stroke-width:2.0;" width="471" x="335" y="524.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="410" x="350" y="539.4639">loop until (rdy_timeout or (DN == 0b &amp;&amp; ERR == 0b &amp;&amp; EXE == 0b)</text><polygon fill="#FF0000" points="722,571.6719,732,575.6719,722,579.6719,726,575.6719" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="728" y1="575.6719" y2="575.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="570.8154">[007]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="396" y="570.8154">Read Control Reg</text><polygon fill="#FF0000" points="722,630.0234,732,634.0234,722,638.0234,726,634.0234" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="728" y1="634.0234" y2="634.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="629.167">[008]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="396" y="629.167">Write Control Reg (CMD = Sanitize, DN = 0b, EXE = 1b)</text><line style="stroke:#008000;stroke-width:1.0;" x1="892" x2="882" y1="634.0234" y2="630.0234"/><line style="stroke:#008000;stroke-width:1.0;" x1="892" x2="882" y1="634.0234" y2="638.0234"/><line style="stroke:#008000;stroke-width:1.0;" x1="734" x2="893" y1="634.0234" y2="634.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="741" y="629.167">[009]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="778" y="629.167"/><polygon fill="#FF0000" points="978,660.375,988,664.375,978,668.375,982,664.375" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="904" x2="984" y1="664.375" y2="664.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="911" y="659.5186">[010]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="944" y="659.5186">Purge</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="398" y1="694.7266" y2="694.7266"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="398" x2="398" y1="694.7266" y2="707.7266"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="357" x2="398" y1="707.7266" y2="707.7266"/><polygon fill="#FF0000" points="367,703.7266,357,707.7266,367,711.7266,363,707.7266" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="689.8701">[011]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="396" y="689.8701">Start timeout</text><polygon fill="#FF0000" points="722,734.0781,732,738.0781,722,742.0781,726,738.0781" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="728" y1="738.0781" y2="738.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="733.2217">[012]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="396" y="733.2217">Read Control Reg</text><path d="M335,750.0781 L612,750.0781 L612,758.0781 L602,768.0781 L335,768.0781 L335,750.0781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="138.1094" style="stroke:#000000;stroke-width:2.0;" width="612" x="335" y="750.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="232" x="350" y="764.5732">loop until (cmd_timeout or DN == 1b)</text><polygon fill="#FF0000" points="722,796.7813,732,800.7813,722,804.7813,726,800.7813" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="728" y1="800.7813" y2="800.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="795.9248">[013]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="396" y="795.9248">Read Control Reg</text><polygon fill="#FF0000" points="745,876.1875,735,880.1875,745,884.1875,741,880.1875" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="739" x2="893" y1="880.1875" y2="880.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="751" y="850.8037">[014]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="784" y="826.2764">Write Control Reg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="784" y="842.6279">(Done = 1b,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="788" y="858.9795">Error = 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="788" y="875.3311">EXE = 0)</text><polygon fill="#FF0000" points="722,920.5391,732,924.5391,722,928.5391,726,924.5391" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="356" x2="728" y1="924.5391" y2="924.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="363" y="919.6826">[015]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="396" y="919.6826">Write Control Reg (DN = 1b)</text><path d="M312,937.5391 L312,963.5391 L725,963.5391 L725,947.5391 L715,937.5391 L312,937.5391 " fill="#FBFB77" filter="url(#f1ccu3907bzaot)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M715,937.5391 L715,947.5391 L725,947.5391 L715,937.5391 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="392" x="318" y="956.0342">Reset the SFR interface for next operation - not waiting for response</text><polygon fill="#FF0000" points="241,1021.5938,231,1025.5938,241,1029.5938,237,1025.5938" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="235" x2="345" y1="1025.5938" y2="1025.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="247" y="1012.5615">[016]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="280" y="1004.3857">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="280" y="1020.7373">Response</text><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="54" y1="1025.5938" y2="1021.5938"/><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="54" y1="1025.5938" y2="1029.5938"/><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="229" y1="1025.5938" y2="1025.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="61" y="1012.5615">[017]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="94" y="1004.3857">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="94" y="1020.7373">Complete</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="153" x="447.75" y="1135.8027">Filename: clear_key_cache.uml</text><!--MD5=[ee9860a84d2aa940f01f4e68e2843467]
@startuml

!include ocp_lock_utils.inc

!if ($show_title)
    Title "Clear the key cache in the Encryption Engine"
!endif

!if ($show_precond)
    note across
        <b>Preconditions:</b>
        * Keys may or may not be loaded in the Key Cache of the Encryption Engine

        <b>Notes:</b>
        * This sequence diagram is not showing any error reporting due to timeouts or errors reported by the Encryption Engine
    end note
!endif

' Pre-existing state


' API call
fw $async mb++ : CLEAR_KEY_CACHE

!if ($show_api)
    note right mb
        | <b>Field    | <b>Size | <b>Definition |
        | chksum      | u32     | Checksum over other input arguments, computed by the caller. Little endian. |
        | rdy_timeout | u32     | Timeout in ms for encryption engine to become ready for a new command |
        | cmd_timeout | u32     | Timeout in ms for command to crypto engine to complete |
    end note
!endif

mb $async cfw++ : Command

!if ($show_msg_parsing)
    cfw $sync mb : Get command
    mb- -
    $self("cfw", "Determine command")
!else
    mb- -
!endif

alt Encryption Engin has become ready

    cfw $sync sfr : Read Control Reg

    alt (DN == 1b || ERR == 1b || EXE == 1b)
        cfw $sync sfr : Write Control Reg (DN = 1b)

        cfw $sync cfw : Start timeout
        cfw $sync sfr : Read Control Reg
        group loop until (rdy_timeout or (DN == 0b && ERR == 0b && EXE == 0b)

            cfw $sync sfr : Read Control Reg
        end
    end

    cfw $sync sfr : Write Control Reg (CMD = Sanitize, DN = 0b, EXE = 1b)
    & sfr $async ee++

    ee $sync kc : Purge

    cfw $sync cfw : Start timeout

    cfw $sync sfr : Read Control Reg
    group loop until (cmd_timeout or DN == 1b)

        cfw $sync sfr : Read Control Reg

        ee $sync sfr- - : Write Control Reg\n(Done = 1b,\n Error = 0,\n EXE = 0)
    end
    sfr- -

    cfw $sync sfr : Write Control Reg (DN = 1b)
    note left sfr : Reset the SFR interface for next operation - not waiting for response

end

cfw $sync mb : Command\nResponse
& mb $async fw++ : Command\nComplete
cfw- -
!if ($show_api)
    ||5||
    note right mb
        | <b>Field   | <b>Size | <b>Definition |
        | chksum      | u32     | Checksum over other output arguments, computed by Caliptra. Little endian. |
        | fips_status | u32     | Indicates if the command is FIPS approved or an error |
    end note
!endif

@enduml

@startuml









	autonumber 1 1  "<b>[000]"

	!pragma teoz true

    participant "Remote Key\nManagement Service" as rkms


    participant "Host" as host


    participant "Storage\nDevice\nFW" as fw

    box "Caliptra"
    	participant "Mail Box" as mb
    	participant "ROM" as crom
    	participant "FW" as cfw
    	participant "ROM to FW\nHandoff Data" as hoff
        participant "DRBG" as rand
        participant "DMA Engine" as dma
        participant "Key Vault" as kv
        participant "Key Vault\nFuses" as fuses
        participant "Key Vault\nStorage Root Key" as gsrk
        participant "Key Vault\nSlot A\n(Storage Root Key)" as srk
        participant "Key Vault\nSlot B\n(PMEK Secret)" as pmeks
        participant "Key Vault\nSlot F\n(DICE Alias Key)\necdsa_secp384r1_sha384" as dice
        participant "Key Vault\nSlot G\n(KEM Keypair)" as kemg
        participant "Key Vault\nSlot W\n(Temporary)" as tempw
        participant "Key Vault\nSlot X\n(MEK Seed)" as meks
        participant "Key Vault\nSlot Y\n(Temporary)" as tempy
        participant "Key Vault\nSlot Z\n(Temporary)" as tempz
        participant "Key Vault\nTemp Memory" as tempmem
    end box

    box "Encryption Engine"
        participant "SFR\nInterface" as sfr
        participant "Control" as ee
        participant "Key Cache" as kc
    end box

    box "Media"
        participant "Create new\Storage Root Key\non NVM subsystem reset" as csrk
        participant "Destroy all\Storage Root Keys\non NVM subsystem reset" as dsrk
    end box

    hide unlinked
	footer Filename: clear_key_cache.uml

	header Version 1


    Title "Clear the key cache in the Encryption Engine"

    note across
        <b>Preconditions:</b>
        * Keys may or may not be loaded in the Key Cache of the Encryption Engine

        <b>Notes:</b>
        * This sequence diagram is not showing any error reporting due to timeouts or errors reported by the Encryption Engine
    end note



fw -[#green]>> mb++ : CLEAR_KEY_CACHE


mb -[#green]>> cfw++ : Command

    mb- -

alt Encryption Engin has become ready

    cfw -[#red]> sfr : Read Control Reg

    alt (DN == 1b || ERR == 1b || EXE == 1b)
        cfw -[#red]> sfr : Write Control Reg (DN = 1b)

        cfw -[#red]> cfw : Start timeout
        cfw -[#red]> sfr : Read Control Reg
        group loop until (rdy_timeout or (DN == 0b && ERR == 0b && EXE == 0b)

            cfw -[#red]> sfr : Read Control Reg
        end
    end

    cfw -[#red]> sfr : Write Control Reg (CMD = Sanitize, DN = 0b, EXE = 1b)
    & sfr -[#green]>> ee++

    ee -[#red]> kc : Purge

    cfw -[#red]> cfw : Start timeout

    cfw -[#red]> sfr : Read Control Reg
    group loop until (cmd_timeout or DN == 1b)

        cfw -[#red]> sfr : Read Control Reg

        ee -[#red]> sfr- - : Write Control Reg\n(Done = 1b,\n Error = 0,\n EXE = 0)
    end
    sfr- -

    cfw -[#red]> sfr : Write Control Reg (DN = 1b)
    note left sfr : Reset the SFR interface for next operation - not waiting for response

end

cfw -[#red]> mb : Command\nResponse
& mb -[#green]>> fw++ : Command\nComplete
cfw- -

@enduml

PlantUML version 1.2021.7(Sun May 23 06:40:07 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>