<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="4309px" preserveAspectRatio="none" style="width:1970px;height:4309px;background:#FFFFFF;" version="1.1" viewBox="0 0 1970 4309" width="1970px" zoomAndPan="magnify"><title>Unlock PMEK</title><defs/><g><rect fill="#DDDDDD" height="4229.8906" style="stroke:#181818;stroke-width:0.5;" width="1661.7788" x="216.8086" y="56.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52.7935" x="1021.3013" y="68.834">Caliptra</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="46.0254" x="1916.1909" y="14.668">Version 1</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="93.5635" x="965.3264" y="41.3125">Unlock PMEK</text><g><title>Storage</title><rect fill="transparent" height="4075.6504" width="8" x="91.1826" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="94.6826" x2="94.6826" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#FFFFFF" height="131.2422" style="stroke:#181818;stroke-width:1;" width="10" x="89.6826" y="4084.4492"/></g><g><title>Mail Box</title><rect fill="transparent" height="4075.6504" width="8" x="253.0845" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="256.5845" x2="256.5845" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#FFFFFF" height="205.1055" style="stroke:#181818;stroke-width:1;" width="10" x="251.5845" y="250.5938"/></g><g><title>FW</title><rect fill="transparent" height="4075.6504" width="8" x="447.5371" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="451.0371" x2="451.0371" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#FFFFFF" height="3784.3027" style="stroke:#181818;stroke-width:1;" width="10" x="446.0371" y="426.3887"/></g><g><title>Key Vault</title><rect fill="transparent" height="4075.6504" width="8" x="1078.8926" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1082.3926" x2="1082.3926" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="737.4941"/></g><g><title/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="897.0469"/></g><g><title/><rect fill="#FFFFFF" height="100.9316" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="1181.1523"/></g><g><title/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="1415.9473"/></g><g><title/><rect fill="#FFFFFF" height="100.9316" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="1745.3633"/></g><g><title/><rect fill="#FFFFFF" height="100.9316" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="1964.8477"/></g><g><title/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="2184.332"/></g><g><title/><rect fill="#FFFFFF" height="165.5527" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="2448.4375"/></g><g><title/><rect fill="#FFFFFF" height="165.5527" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="2747.8535"/></g><g><title/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="3062.5801"/></g><g><title/><rect fill="#FFFFFF" height="159.5527" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="3310.0645"/></g><g><title/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="3572.8594"/></g><g><title/><rect fill="#FFFFFF" height="130.2422" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="3806.3438"/></g><g><title/><rect fill="#FFFFFF" height="58.6211" style="stroke:#181818;stroke-width:1;" width="10" x="1077.3926" y="3981.207"/></g><g><title>Key Vault</title><rect fill="transparent" height="4075.6504" width="8" x="1355.9385" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1359.4385" x2="1359.4385" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#ADD8E6" height="3986.4082" style="stroke:#181818;stroke-width:1;" width="10" x="1354.4385" y="229.2832"/></g><g><title>Key Vault</title><rect fill="transparent" height="4075.6504" width="8" x="1488.042" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1491.542" x2="1491.542" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#ADD8E6" height="3986.4082" style="stroke:#181818;stroke-width:1;" width="10" x="1486.542" y="229.2832"/></g><g><title>Key Vault</title><rect fill="transparent" height="4075.6504" width="8" x="1604.1563" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1607.6563" x2="1607.6563" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#ADD8E6" height="3986.4082" style="stroke:#181818;stroke-width:1;" width="10" x="1602.6563" y="229.2832"/></g><g><title>Key Vault</title><rect fill="transparent" height="4075.6504" width="8" x="1715.9741" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1719.4741" x2="1719.4741" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#ADD8E6" height="2757.7441" style="stroke:#181818;stroke-width:1;" width="10" x="1714.4741" y="1252.7734"/></g><line style="stroke:#181818;stroke-width:2;" x1="1710.4741" x2="1728.4741" y1="4001.5176" y2="4019.5176"/><line style="stroke:#181818;stroke-width:2;" x1="1710.4741" x2="1728.4741" y1="4019.5176" y2="4001.5176"/><g><title>Key Vault</title><rect fill="transparent" height="4075.6504" width="8" x="1822.7163" y="140.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1826.2163" x2="1826.2163" y1="140.041" y2="4215.6914"/></g><g><title/><rect fill="#ADD8E6" height="847.0059" style="stroke:#181818;stroke-width:1;" width="10" x="1821.2163" y="3163.5117"/></g><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.3652" x="62" y="75.5762"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.3652" x="69" y="96.1113">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.5498" x="72.4077" y="112.5996">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.4824" x="84.9414" y="129.0879">FW</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71.5518" x="220.8086" y="108.5527"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.5518" x="227.8086" y="129.0879">Mail Box</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="33.4824" x="434.2959" y="108.5527"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.4824" x="441.2959" y="129.0879">FW</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77.54" x="1043.6226" y="108.5527"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1050.6226" y="129.0879">Key Vault</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.8721" x="1290.0024" y="75.5762"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1327.6685" y="96.1113">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5117" x="1339.6826" y="112.5996">Slot A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.8721" x="1297.0024" y="129.0879">(Storage Root Key)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105.335" x="1438.8745" y="75.5762"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1459.772" y="96.1113">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.9053" x="1472.5894" y="112.5996">Slot B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91.335" x="1445.8745" y="129.0879">(PMEK Secret)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106.8936" x="1554.2095" y="75.5762"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1575.8862" y="96.1113">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.9697" x="1587.6714" y="112.5996">Slot G</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.8936" x="1561.2095" y="129.0879">(KEM Keypair)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7422" x="1671.103" y="75.5762"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1687.7041" y="96.1113">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.5752" x="1700.1865" y="112.5996">Slot Y</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7422" x="1678.103" y="129.0879">(Temporary)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7422" x="1777.8452" y="75.5762"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1794.4463" y="96.1113">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.3154" x="1807.0586" y="112.5996">Slot Z</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7422" x="1784.8452" y="129.0879">(Temporary)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.3652" x="62" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.3652" x="69" y="4236.2266">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.5498" x="72.4077" y="4252.7148">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.4824" x="84.9414" y="4269.2031">FW</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71.5518" x="220.8086" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57.5518" x="227.8086" y="4236.2266">Mail Box</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="33.4824" x="434.2959" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.4824" x="441.2959" y="4236.2266">FW</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77.54" x="1043.6226" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1050.6226" y="4236.2266">Key Vault</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.8721" x="1290.0024" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1327.6685" y="4236.2266">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5117" x="1339.6826" y="4252.7148">Slot A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.8721" x="1297.0024" y="4269.2031">(Storage Root Key)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105.335" x="1438.8745" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1459.772" y="4236.2266">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.9053" x="1472.5894" y="4252.7148">Slot B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91.335" x="1445.8745" y="4269.2031">(PMEK Secret)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106.8936" x="1554.2095" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1575.8862" y="4236.2266">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.9697" x="1587.6714" y="4252.7148">Slot G</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.8936" x="1561.2095" y="4269.2031">(KEM Keypair)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7422" x="1671.103" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1687.7041" y="4236.2266">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.5752" x="1700.1865" y="4252.7148">Slot Y</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7422" x="1678.103" y="4269.2031">(Temporary)</text><rect fill="#E2E2F0" height="63.4648" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.7422" x="1777.8452" y="4215.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.54" x="1794.4463" y="4236.2266">Key Vault</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.3154" x="1807.0586" y="4252.7148">Slot Z</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7422" x="1784.8452" y="4269.2031">(Temporary)</text><path d="M59.1558,153.041 L59.1558,224.041 L1861.1558,224.041 L1861.1558,163.041 L1851.1558,153.041 L59.1558,153.041 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1851.1558,153.041 L1851.1558,163.041 L1861.1558,163.041 L1851.1558,153.041 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="94.999" x="761.9033" y="170.6094">Preconditions:</text><ellipse cx="767.4033" cy="181.1621" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325.6094" x="773.9033" y="185.9199">Access Shared Secret already availble in a slot in KV</text><ellipse cx="767.4033" cy="196.4727" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="376.0923" x="773.9033" y="201.2305">unlocking key already in a slot and generated on each reset</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313.8853" x="761.9033" y="216.541">Is there a separate Shared Secret per Admin User?</text><line style="stroke:#008000;stroke-width:1;" x1="249.5845" x2="239.5845" y1="250.5938" y2="246.5938"/><line style="stroke:#008000;stroke-width:1;" x1="249.5845" x2="239.5845" y1="250.5938" y2="254.5938"/><line style="stroke:#008000;stroke-width:1;" x1="94.6826" x2="250.5845" y1="250.5938" y2="250.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="101.6826" y="245.8516">[001]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.5391" x="141.0454" y="245.8516">UNLOCK_PMEK</text><path d="M266.5845,263.5938 L266.5845,399.5938 L889.5845,399.5938 L889.5845,273.5938 L879.5845,263.5938 L266.5845,263.5938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M879.5845,263.5938 L879.5845,273.5938 L889.5845,273.5938 L879.5845,263.5938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="272.5845" y="283.1621">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32.1509" x="276.6978" y="283.1621">Field</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="414.8545" y="283.1621">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="26.9521" x="418.9678" y="283.1621">Size</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="543.7944" y="283.1621">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66.644" x="547.9077" y="283.1621">Definition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49.1563" x="276.6978" y="298.4727">chksum</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24.5083" x="418.9678" y="298.4727">u32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78.0254" x="547.9077" y="298.4727">Little endian</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.9302" x="276.6978" y="313.7832">wrapped_access_key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.7134" x="418.9678" y="313.7832">WrappedAccessKey</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.4087" x="547.9077" y="313.7832">KEM-wrapped access key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.3535" x="543.7944" y="329.0938">* kem_handle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.915" x="543.7944" y="344.4043">*kem_algorithm</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.9111" x="543.7944" y="359.7148">*kem_ciphertext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.5542" x="543.7944" y="375.0254">* encrypted_access_key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.0845" x="276.6978" y="390.3359">locked_pmek</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.5161" x="418.9678" y="390.3359">EncryptedPmek</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="323.3813" x="547.9077" y="390.3359">PMEK encrypted to storage root key and access key</text><line style="stroke:#000000;stroke-width:0.5;" x1="272.5845" x2="875.4023" y1="270.5938" y2="270.5938"/><line style="stroke:#000000;stroke-width:0.5;" x1="272.5845" x2="875.4023" y1="285.9043" y2="285.9043"/><line style="stroke:#000000;stroke-width:0.5;" x1="272.5845" x2="875.4023" y1="301.2148" y2="301.2148"/><line style="stroke:#000000;stroke-width:0.5;" x1="272.5845" x2="875.4023" y1="377.7676" y2="377.7676"/><line style="stroke:#000000;stroke-width:0.5;" x1="272.5845" x2="875.4023" y1="393.0781" y2="393.0781"/><line style="stroke:#000000;stroke-width:0.5;" x1="272.5845" x2="272.5845" y1="270.5938" y2="393.0781"/><line style="stroke:#000000;stroke-width:0.5;" x1="414.8545" x2="414.8545" y1="270.5938" y2="393.0781"/><line style="stroke:#000000;stroke-width:0.5;" x1="543.7944" x2="543.7944" y1="270.5938" y2="393.0781"/><line style="stroke:#000000;stroke-width:0.5;" x1="875.4023" x2="875.4023" y1="270.5938" y2="393.0781"/><line style="stroke:#008000;stroke-width:1;" x1="444.0371" x2="434.0371" y1="426.3887" y2="422.3887"/><line style="stroke:#008000;stroke-width:1;" x1="444.0371" x2="434.0371" y1="426.3887" y2="430.3887"/><line style="stroke:#008000;stroke-width:1;" x1="261.5845" x2="445.0371" y1="426.3887" y2="426.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="268.5845" y="421.6465">[002]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.6826" x="307.9473" y="421.6465">Command</text><polygon fill="#FF0000" points="272.5845,451.6992,262.5845,455.6992,272.5845,459.6992,268.5845,455.6992" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="266.5845" x2="445.0371" y1="455.6992" y2="455.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="278.5845" y="450.957">[003]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.9595" x="317.9473" y="450.957">Get command</text><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="498.0371" y1="485.0098" y2="485.0098"/><line style="stroke:#FF0000;stroke-width:1;" x1="498.0371" x2="498.0371" y1="485.0098" y2="498.0098"/><line style="stroke:#FF0000;stroke-width:1;" x1="457.0371" x2="498.0371" y1="498.0098" y2="498.0098"/><polygon fill="#FF0000" points="467.0371,494.0098,457.0371,498.0098,467.0371,502.0098,463.0371,498.0098" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="480.2676">[004]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.0693" x="502.3999" y="480.2676">Determine command</text><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="498.0371" y1="527.3203" y2="527.3203"/><line style="stroke:#FF0000;stroke-width:1;" x1="498.0371" x2="498.0371" y1="527.3203" y2="540.3203"/><line style="stroke:#FF0000;stroke-width:1;" x1="457.0371" x2="498.0371" y1="540.3203" y2="540.3203"/><polygon fill="#FF0000" points="467.0371,536.3203,457.0371,540.3203,467.0371,544.3203,463.0371,540.3203" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="522.5781">[005]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.3853" x="502.3999" y="522.5781">Determine rate of unlocking</text><path d="M8,552.3203 L70.1387,552.3203 L70.1387,559.6309 L60.1387,569.6309 L8,569.6309 L8,552.3203 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="transparent" height="3554.1289" style="stroke:#000000;stroke-width:1.5;" width="1889.2163" x="8" y="552.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="23" y="565.8887">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="142.1514" x="85.1387" y="564.9551">[Storage Root Key exists]</text><path d="M27,583.6309 L89.1387,583.6309 L89.1387,590.9414 L79.1387,600.9414 L27,600.9414 L27,583.6309 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="transparent" height="3508.8184" style="stroke:#000000;stroke-width:1.5;" width="1845.2163" x="27" y="583.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="42" y="597.1992">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="186.4897" x="104.1387" y="596.2656">[Unlocking rate below threshold]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="631.5967"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="631.5967" y2="631.5967"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="634.5967" y2="634.5967"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="145.2949" x="882.9607" y="620.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127.0103" x="888.9607" y="637.5098">Get the Access Key</text><path d="M46,658.252 L108.1387,658.252 L108.1387,665.5625 L98.1387,675.5625 L46,675.5625 L46,658.252 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="transparent" height="895.9375" style="stroke:#000000;stroke-width:1.5;" width="1694.4741" x="46" y="658.252"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="61" y="671.8203">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="294.0889" x="123.1387" y="670.8867">[kem_id = 0x0011 (DHKEM(P-384, HKDF-SHA384))]</text><polygon fill="#FF0000" points="1065.3926,733.4941,1075.3926,737.4941,1065.3926,741.4941,1069.3926,737.4941" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="737.4941" y2="737.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="717.4414">[006]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2349" x="502.3999" y="702.1309">ECDH(KEM Pair : kem_handle (G),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.9976" x="551.7593" y="717.4414">KEM ciphertext : kem_ciphertext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3276" x="551.7593" y="732.752">Destination : memory)</text><polygon fill="#FF0000" points="1590.6563,762.8047,1600.6563,766.8047,1590.6563,770.8047,1594.6563,766.8047" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1596.6563" y1="766.8047" y2="766.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="762.0625">[007]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.416" x="1133.7554" y="762.0625">Get KEM Keypair</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="796.1152" y2="796.1152"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="796.1152" y2="809.1152"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="809.1152" y2="809.1152"/><polygon fill="#FF0000" points="1098.3926,805.1152,1088.3926,809.1152,1098.3926,813.1152,1094.3926,809.1152" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="791.373">[008]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.6831" x="1133.7554" y="791.373">ECDH KEM Ciphertext with Keypair</text><polygon fill="#FF0000" points="467.0371,834.4258,457.0371,838.4258,467.0371,842.4258,463.0371,838.4258" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="838.4258" y2="838.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="833.6836">[009]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.5098" x="512.3999" y="833.6836">Put DH result</text><polygon fill="#FF0000" points="467.0371,863.7363,457.0371,867.7363,467.0371,871.7363,463.0371,867.7363" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="867.7363" y2="867.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="862.9941">[010]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="862.9941">done</text><polygon fill="#FF0000" points="1065.3926,893.0469,1075.3926,897.0469,1065.3926,901.0469,1069.3926,897.0469" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="897.0469" y2="897.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="892.3047">[011]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272.0098" x="502.3999" y="892.3047">ECC_GetPubKey(KEM Pair : kem_handle (G))</text><polygon fill="#FF0000" points="1590.6563,922.3574,1600.6563,926.3574,1590.6563,930.3574,1594.6563,926.3574" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1596.6563" y1="926.3574" y2="926.3574"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="921.6152">[012]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.416" x="1133.7554" y="921.6152">Get KEM Keypair</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="955.668" y2="955.668"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="955.668" y2="968.668"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="968.668" y2="968.668"/><polygon fill="#FF0000" points="1098.3926,964.668,1088.3926,968.668,1098.3926,972.668,1094.3926,968.668" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="950.9258">[013]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.0874" x="1133.7554" y="950.9258">ECC derive public key</text><polygon fill="#FF0000" points="467.0371,993.9785,457.0371,997.9785,467.0371,1001.9785,463.0371,997.9785" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="997.9785" y2="997.9785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="993.2363">[014]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82.1387" x="512.3999" y="993.2363">Put kem_pub</text><polygon fill="#FF0000" points="467.0371,1023.2891,457.0371,1027.2891,467.0371,1031.2891,463.0371,1027.2891" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="1027.2891" y2="1027.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="1022.5469">[015]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="1022.5469">done</text><path d="M461.0371,1040.2891 L461.0371,1065.2891 L894.0371,1065.2891 L894.0371,1050.2891 L884.0371,1040.2891 L461.0371,1040.2891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M884.0371,1040.2891 L884.0371,1050.2891 L894.0371,1050.2891 L884.0371,1040.2891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="412.8896" x="467.0371" y="1057.8574">The next steps come from RFC 9180, section 4.1, Decap function</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="1091.2549"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="1091.2549" y2="1091.2549"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="1094.2549" y2="1094.2549"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="341.5771" x="784.8196" y="1080.5996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="323.2925" x="790.8196" y="1097.168">Derive HPKE pseudo-random key material (PRK)</text><polygon fill="#FF0000" points="1065.3926,1177.1523,1075.3926,1181.1523,1065.3926,1185.1523,1069.3926,1181.1523" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="1181.1523" y2="1181.1523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="1153.4443">[016]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.793" x="502.3999" y="1130.4785">HMAC384(Key : empty,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.0225" x="605.2319" y="1145.7891">Key Data : "HPKE-v1" | "KEM" | 0x0011 (kem_id) |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299.9839" x="502.3999" y="1161.0996">"                                         eae_prk" | DH result</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.4214" x="605.2319" y="1176.4102">Destination Slot: Y)</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="1210.4629" y2="1210.4629"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="1210.4629" y2="1223.4629"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="1223.4629" y2="1223.4629"/><polygon fill="#FF0000" points="1098.3926,1219.4629,1088.3926,1223.4629,1098.3926,1227.4629,1094.3926,1223.4629" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="1205.7207">[017]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.0703" x="1133.7554" y="1205.7207">HMAC384 operation</text><polygon fill="#FF0000" points="1702.4741,1248.7734,1712.4741,1252.7734,1702.4741,1256.7734,1706.4741,1252.7734" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="1252.7734" y2="1252.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="1248.0313">[018]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.3711" x="1133.7554" y="1248.0313">HMAC384 result PRK</text><polygon fill="#FF0000" points="467.0371,1278.084,457.0371,1282.084,467.0371,1286.084,463.0371,1282.084" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="1282.084" y2="1282.084"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="1277.3418">[019]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="1277.3418">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="1310.7393"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="1310.7393" y2="1310.7393"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="1313.7393" y2="1313.7393"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="196.0381" x="857.5891" y="1300.084"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="177.7534" x="863.5891" y="1316.6523">Derive HPKE shared secret</text><polygon fill="#FF0000" points="1065.3926,1411.9473,1075.3926,1415.9473,1065.3926,1419.9473,1069.3926,1415.9473" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="1415.9473" y2="1415.9473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="1380.584">[020]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.397" x="502.3999" y="1349.9629">HMAC384(Key : Slot Y,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320.6201" x="605.2319" y="1365.2734">Data : 0x0030 (big-endian 48) | "HPKE-v1" | "KEM"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336.6226" x="646.3647" y="1380.584">0x0011 (kem_id) | "shared_secret" | kem_ciphertext |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242.3662" x="646.3647" y="1395.8945">kem_pub | 0x01 (HKDF block number)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.4214" x="605.2319" y="1411.2051">Destination Slot: Y)</text><polygon fill="#FF0000" points="1702.4741,1441.2578,1712.4741,1445.2578,1702.4741,1449.2578,1706.4741,1445.2578" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="1445.2578" y2="1445.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="1440.5156">[021]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.8901" x="1133.7554" y="1440.5156">Get HPKE PRK</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="1474.5684" y2="1474.5684"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="1474.5684" y2="1487.5684"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="1487.5684" y2="1487.5684"/><polygon fill="#FF0000" points="1098.3926,1483.5684,1088.3926,1487.5684,1098.3926,1491.5684,1094.3926,1487.5684" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="1469.8262">[022]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.2676" x="1133.7554" y="1469.8262">HMAC384 slot Y with data</text><polygon fill="#FF0000" points="1702.4741,1512.8789,1712.4741,1516.8789,1702.4741,1520.8789,1706.4741,1516.8789" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="1516.8789" y2="1516.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="1512.1367">[023]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.1626" x="1133.7554" y="1512.1367">HMAC384 result shared secret</text><polygon fill="#FF0000" points="467.0371,1542.1895,457.0371,1546.1895,467.0371,1550.1895,463.0371,1546.1895" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="1546.1895" y2="1546.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="1541.4473">[024]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="1541.4473">done</text><path d="M46,1572.1895 L108.1387,1572.1895 L108.1387,1579.5 L98.1387,1589.5 L46,1589.5 L46,1572.1895 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="transparent" height="1628.6328" style="stroke:#000000;stroke-width:1.5;" width="1801.2163" x="46" y="1572.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="61" y="1585.7578">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="692.1299" x="123.1387" y="1584.8242">[kem_id = 0x0011 (DHKEM(P-384, HKDF-SHA384)), kdf_id = 0x0002 (HKDF-SHA384), aead_id = 0x0002 (AES-256-GCM)]</text><path d="M461.0371,1604.5 L461.0371,1629.5 L1234.0371,1629.5 L1234.0371,1614.5 L1224.0371,1604.5 L461.0371,1604.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1224.0371,1604.5 L1224.0371,1614.5 L1234.0371,1614.5 L1224.0371,1604.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="752.7178" x="467.0371" y="1622.0684">The next steps come from RFC 9180, sections 5.1 and 5.2, KeyScheduleBase and ContextR.Open functions respectively</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="1655.4658"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="1655.4658" y2="1655.4658"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="1658.4658" y2="1658.4658"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="331.2686" x="789.9739" y="1644.8105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="312.9839" x="795.9739" y="1661.3789">Derive HPKE psk_id_hash and store in memory</text><polygon fill="#FF0000" points="1065.3926,1741.3633,1075.3926,1745.3633,1065.3926,1749.3633,1069.3926,1745.3633" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="1745.3633" y2="1745.3633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="1717.6553">[025]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.793" x="502.3999" y="1694.6895">HMAC384(Key : empty,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="403.6538" x="605.2319" y="1710">Data : "HPKE-v1" | "HPKE" | 0x0011 (kem_id) | 0x0002 (kdf_id) |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305.7476" x="646.3647" y="1725.3105">0x0002 (aead_id) | "psk_id_hash" | "" (no PSK ID)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3276" x="605.2319" y="1740.6211">Destination : memory)</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="1774.6738" y2="1774.6738"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="1774.6738" y2="1787.6738"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="1787.6738" y2="1787.6738"/><polygon fill="#FF0000" points="1098.3926,1783.6738,1088.3926,1787.6738,1098.3926,1791.6738,1094.3926,1787.6738" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="1769.9316">[026]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.0703" x="1133.7554" y="1769.9316">HMAC384 operation</text><polygon fill="#FF0000" points="467.0371,1812.9844,457.0371,1816.9844,467.0371,1820.9844,463.0371,1816.9844" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="1816.9844" y2="1816.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="1812.2422">[027]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.7676" x="512.3999" y="1812.2422">HMAC384 result psk_id_hash</text><polygon fill="#FF0000" points="467.0371,1842.2949,457.0371,1846.2949,467.0371,1850.2949,463.0371,1846.2949" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="1846.2949" y2="1846.2949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="1841.5527">[028]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="1841.5527">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="1874.9502"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="1874.9502" y2="1874.9502"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="1877.9502" y2="1877.9502"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="314.1934" x="798.5115" y="1864.2949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="295.9087" x="804.5115" y="1880.8633">Derive HPKE info_hash and store in memory</text><polygon fill="#FF0000" points="1065.3926,1960.8477,1075.3926,1964.8477,1065.3926,1968.8477,1069.3926,1964.8477" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="1964.8477" y2="1964.8477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="1937.1396">[029]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.793" x="502.3999" y="1914.1738">HMAC384(Key : empty,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="403.6538" x="605.2319" y="1929.4844">Data : "HPKE-v1" | "HPKE" | 0x0011 (kem_id) | 0x0002 (kdf_id) |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305.6523" x="646.3647" y="1944.7949">0x0002 (aead_id) | "info_hash" | "enable_access"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.2144" x="605.2319" y="1960.1055">Destination: memory)</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="1994.1582" y2="1994.1582"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="1994.1582" y2="2007.1582"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="2007.1582" y2="2007.1582"/><polygon fill="#FF0000" points="1098.3926,2003.1582,1088.3926,2007.1582,1098.3926,2011.1582,1094.3926,2007.1582" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="1989.416">[030]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.0703" x="1133.7554" y="1989.416">HMAC384 operation</text><polygon fill="#FF0000" points="467.0371,2032.4688,457.0371,2036.4688,467.0371,2040.4688,463.0371,2036.4688" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="2036.4688" y2="2036.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="2031.7266">[031]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.5112" x="512.3999" y="2031.7266">HMAC384 result info_hash</text><polygon fill="#FF0000" points="467.0371,2061.7793,457.0371,2065.7793,467.0371,2069.7793,463.0371,2065.7793" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="2065.7793" y2="2065.7793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="2061.0371">[032]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="2061.0371">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="2094.4346"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="2094.4346" y2="2094.4346"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="2097.4346" y2="2097.4346"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="282.9756" x="814.1204" y="2083.7793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="264.6909" x="820.1204" y="2100.3477">Derive HPKE secret and store in KV slot</text><polygon fill="#FF0000" points="1065.3926,2180.332,1075.3926,2184.332,1065.3926,2188.332,1069.3926,2184.332" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="2184.332" y2="2184.332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="2156.624">[033]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.397" x="502.3999" y="2133.6582">HMAC384(Key : Slot Y,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="403.6538" x="605.2319" y="2148.9688">Data : "HPKE-v1" | "HPKE" | 0x0011 (kem_id) | 0x0002 (kdf_id) |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.8154" x="646.3647" y="2164.2793">0x0002 (aead_id) | "secret" | "" (no PSK)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.4214" x="605.2319" y="2179.5898">Destination Slot: Y)</text><polygon fill="#FF0000" points="1702.4741,2209.6426,1712.4741,2213.6426,1702.4741,2217.6426,1706.4741,2213.6426" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="2213.6426" y2="2213.6426"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="2208.9004">[034]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.6816" x="1133.7554" y="2208.9004">Get HPKE shared secret</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="2242.9531" y2="2242.9531"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="2242.9531" y2="2255.9531"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="2255.9531" y2="2255.9531"/><polygon fill="#FF0000" points="1098.3926,2251.9531,1088.3926,2255.9531,1098.3926,2259.9531,1094.3926,2255.9531" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="2238.2109">[035]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.2676" x="1133.7554" y="2238.2109">HMAC384 slot Y with data</text><polygon fill="#FF0000" points="1702.4741,2281.2637,1712.4741,2285.2637,1702.4741,2289.2637,1706.4741,2285.2637" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="2285.2637" y2="2285.2637"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="2280.5215">[036]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.4312" x="1133.7554" y="2280.5215">HMAC384 result secret</text><polygon fill="#FF0000" points="467.0371,2310.5742,457.0371,2314.5742,467.0371,2318.5742,463.0371,2314.5742" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="2314.5742" y2="2314.5742"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="2309.832">[037]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="2309.832">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="2343.2295"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="2343.2295" y2="2343.2295"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="2346.2295" y2="2346.2295"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="326.8062" x="792.2051" y="2332.5742"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="308.5215" x="798.2051" y="2349.1426">Derive HPKE base_nonce and store in memory</text><polygon fill="#FF0000" points="1065.3926,2444.4375,1075.3926,2448.4375,1065.3926,2452.4375,1069.3926,2448.4375" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="2448.4375" y2="2448.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="2413.0742">[038]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.397" x="502.3999" y="2382.4531">HMAC384(Key : Slot Y,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="456.0474" x="605.2319" y="2397.7637">Data : 0x000C (big-endian 12) | "HPKE-v1" | "HPKE" | 0x0011 (kem_id) |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="329.1069" x="646.3647" y="2413.0742">0x0002 (kdf_id) | 0x0002 (aead_id) | "base_nonce" |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281.6201" x="646.3647" y="2428.3848">0x00 (HPKE mode) | psk_id_hash | info_hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.2144" x="605.2319" y="2443.6953">Destination: memory)</text><polygon fill="#FF0000" points="1702.4741,2473.748,1712.4741,2477.748,1702.4741,2481.748,1706.4741,2477.748" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="2477.748" y2="2477.748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="2473.0059">[039]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.9502" x="1133.7554" y="2473.0059">Get HPKE secret</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="2507.0586" y2="2507.0586"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="2507.0586" y2="2520.0586"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="2520.0586" y2="2520.0586"/><polygon fill="#FF0000" points="1098.3926,2516.0586,1088.3926,2520.0586,1098.3926,2524.0586,1094.3926,2520.0586" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="2502.3164">[040]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.2676" x="1133.7554" y="2502.3164">HMAC384 slot Y with data</text><polygon fill="#FF0000" points="467.0371,2545.3691,457.0371,2549.3691,467.0371,2553.3691,463.0371,2549.3691" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="2549.3691" y2="2549.3691"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="2544.627">[041]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.2319" x="512.3999" y="2544.627">HMAC384 result base_nonce</text><path d="M1092.3926,2562.3691 L1092.3926,2587.3691 L1368.3926,2587.3691 L1368.3926,2572.3691 L1358.3926,2562.3691 L1092.3926,2562.3691 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1358.3926,2562.3691 L1358.3926,2572.3691 L1368.3926,2572.3691 L1358.3926,2562.3691 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255.7852" x="1098.3926" y="2579.9375">The base_nonce is truncated to 12 bytes</text><polygon fill="#FF0000" points="467.0371,2609.9902,457.0371,2613.9902,467.0371,2617.9902,463.0371,2613.9902" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="2613.9902" y2="2613.9902"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="2609.248">[042]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="2609.248">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="2642.6455"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="2642.6455" y2="2642.6455"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="2645.6455" y2="2645.6455"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="265.7163" x="822.75" y="2631.9902"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="247.4316" x="828.75" y="2648.5586">Derive HPKE key and store in KV slot</text><polygon fill="#FF0000" points="1065.3926,2743.8535,1075.3926,2747.8535,1065.3926,2751.8535,1069.3926,2747.8535" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="2747.8535" y2="2747.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="2712.4902">[043]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.397" x="502.3999" y="2681.8691">HMAC384(Key : Slot Y,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="455.2729" x="605.2319" y="2697.1797">Data : 0x0020 (big-endian 32) | "HPKE-v1" | "HPKE" | 0x0011 (kem_id) |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276.9863" x="646.3647" y="2712.4902">0x0002 (kdf_id) | 0x0002 (aead_id) | "key" |</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281.6201" x="646.3647" y="2727.8008">0x00 (HPKE mode) | psk_id_hash | info_hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.4214" x="605.2319" y="2743.1113">Destination Slot: Y)</text><polygon fill="#FF0000" points="1702.4741,2773.1641,1712.4741,2777.1641,1702.4741,2781.1641,1706.4741,2777.1641" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="2777.1641" y2="2777.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="2772.4219">[044]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.9502" x="1133.7554" y="2772.4219">Get HPKE secret</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="2806.4746" y2="2806.4746"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="2806.4746" y2="2819.4746"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="2819.4746" y2="2819.4746"/><polygon fill="#FF0000" points="1098.3926,2815.4746,1088.3926,2819.4746,1098.3926,2823.4746,1094.3926,2819.4746" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="2801.7324">[045]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.2676" x="1133.7554" y="2801.7324">HMAC384 slot Y with data</text><polygon fill="#FF0000" points="1702.4741,2844.7852,1712.4741,2848.7852,1702.4741,2852.7852,1706.4741,2848.7852" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="2848.7852" y2="2848.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="2844.043">[046]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.1113" x="1133.7554" y="2844.043">HMAC384 result key</text><path d="M1092.3926,2861.7852 L1092.3926,2886.7852 L1524.3926,2886.7852 L1524.3926,2871.7852 L1514.3926,2861.7852 L1092.3926,2861.7852 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1514.3926,2861.7852 L1514.3926,2871.7852 L1524.3926,2871.7852 L1514.3926,2861.7852 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411.3599" x="1098.3926" y="2879.3535">The key is truncated to 32 bytes for use as an AES-256-GCM key</text><polygon fill="#FF0000" points="467.0371,2909.4063,457.0371,2913.4063,467.0371,2917.4063,463.0371,2913.4063" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="2913.4063" y2="2913.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="2908.6641">[047]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="2908.6641">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="2942.0615"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="2942.0615" y2="2942.0615"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="2945.0615" y2="2945.0615"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="283.2612" x="813.9775" y="2931.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="264.9766" x="819.9775" y="2947.9746">Decrypt access key and store in KV Slot</text><polygon fill="#FF0000" points="1065.3926,3058.5801,1075.3926,3062.5801,1065.3926,3066.5801,1069.3926,3062.5801" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="3062.5801" y2="3062.5801"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="3019.5615">[048]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.3296" x="502.3999" y="2981.2852">AES-256-GCM(Key : Slot Y,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.4512" x="551.7593" y="2996.5957">IV : base_nonce,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291.8018" x="551.7593" y="3011.9063">Ciphertext : encrypted_access_key_ciphertext,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.7817" x="551.7593" y="3027.2168">Tag : encrypted_access_key_tag,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53.8408" x="551.7593" y="3042.5273">AAD : "",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.2935" x="551.7593" y="3057.8379">Destination : Slot Z)</text><polygon fill="#FF0000" points="1702.4741,3087.8906,1712.4741,3091.8906,1702.4741,3095.8906,1706.4741,3091.8906" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="3091.8906" y2="3091.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3087.1484">[049]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.6304" x="1133.7554" y="3087.1484">Get HPKE key</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="3121.2012" y2="3121.2012"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="3121.2012" y2="3134.2012"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="3134.2012" y2="3134.2012"/><polygon fill="#FF0000" points="1098.3926,3130.2012,1088.3926,3134.2012,1098.3926,3138.2012,1094.3926,3134.2012" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3116.459">[050]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.5127" x="1133.7554" y="3116.459">AES-256-GCM decrypt access key</text><polygon fill="#FF0000" points="1809.2163,3159.5117,1819.2163,3163.5117,1809.2163,3167.5117,1813.2163,3163.5117" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1815.2163" y1="3163.5117" y2="3163.5117"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3158.7695">[051]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.9683" x="1133.7554" y="3158.7695">Put access key</text><polygon fill="#FF0000" points="467.0371,3188.8223,457.0371,3192.8223,467.0371,3196.8223,463.0371,3192.8223" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="3192.8223" y2="3192.8223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="3188.0801">[052]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="3188.0801">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="3235.4775"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="3235.4775" y2="3235.4775"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="3238.4775" y2="3238.4775"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="192.0073" x="859.6045" y="3224.8223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="173.7227" x="865.6045" y="3241.3906">Create the Encryption Key</text><polygon fill="#FF0000" points="1065.3926,3306.0645,1075.3926,3310.0645,1065.3926,3314.0645,1069.3926,3310.0645" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="3310.0645" y2="3310.0645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="3290.0117">[053]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.0005" x="502.3999" y="3274.7012">HMAC512_Slots(Key : Slot A,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.5112" x="605.2319" y="3290.0117">Data Key : Slot Z</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.4214" x="605.2319" y="3305.3223">Destination Slot: Y)</text><polygon fill="#FF0000" points="1342.4385,3335.375,1352.4385,3339.375,1342.4385,3343.375,1346.4385,3339.375" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1348.4385" y1="3339.375" y2="3339.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3334.6328">[054]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.1104" x="1133.7554" y="3334.6328">Get Storage Root Key</text><polygon fill="#FF0000" points="1809.2163,3364.6855,1819.2163,3368.6855,1809.2163,3372.6855,1813.2163,3368.6855" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1815.2163" y1="3368.6855" y2="3368.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3363.9434">[055]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.0308" x="1133.7554" y="3363.9434">Get Access Key</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="3397.9961" y2="3397.9961"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="3397.9961" y2="3410.9961"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="3410.9961" y2="3410.9961"/><polygon fill="#FF0000" points="1098.3926,3406.9961,1088.3926,3410.9961,1098.3926,3414.9961,1094.3926,3410.9961" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3393.2539">[056]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.6875" x="1133.7554" y="3393.2539">HMAC512 Slot A with Slot Z</text><polygon fill="#FF0000" points="1702.4741,3436.3066,1712.4741,3440.3066,1702.4741,3444.3066,1706.4741,3440.3066" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="3440.3066" y2="3440.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3435.5645">[057]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.394" x="1133.7554" y="3435.5645">HMAC512 result PMEK</text><polygon fill="#FF0000" points="467.0371,3465.6172,457.0371,3469.6172,467.0371,3473.6172,463.0371,3469.6172" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="3469.6172" y2="3469.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="3464.875">[058]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="3464.875">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="3498.2725"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="3498.2725" y2="3498.2725"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="3501.2725" y2="3501.2725"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="244.1089" x="833.5537" y="3487.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="225.8242" x="839.5537" y="3504.1855">Extract PMEK with Encryption Key</text><polygon fill="#FF0000" points="1065.3926,3568.8594,1075.3926,3572.8594,1065.3926,3576.8594,1069.3926,3572.8594" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="3572.8594" y2="3572.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="3552.8066">[059]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.7944" x="502.3999" y="3537.4961">Unwrap(Key : Slot Y,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.269" x="551.7593" y="3552.8066">Data: locked_pmek</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.4067" x="551.7593" y="3568.1172">Destination :  Slot Z)</text><polygon fill="#FF0000" points="1702.4741,3598.1699,1712.4741,3602.1699,1702.4741,3606.1699,1706.4741,3602.1699" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="3602.1699" y2="3602.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3597.4277">[060]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.9868" x="1133.7554" y="3597.4277">Get Encryption Key</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="3631.4805" y2="3631.4805"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="3631.4805" y2="3644.4805"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="3644.4805" y2="3644.4805"/><polygon fill="#FF0000" points="1098.3926,3640.4805,1088.3926,3644.4805,1098.3926,3648.4805,1094.3926,3644.4805" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3626.7383">[061]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.9922" x="1133.7554" y="3626.7383">Decrypt locked_pmek</text><polygon fill="#FF0000" points="1809.2163,3669.791,1819.2163,3673.791,1809.2163,3677.791,1813.2163,3673.791" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1815.2163" y1="3673.791" y2="3673.791"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3669.0488">[062]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.9155" x="1133.7554" y="3669.0488">PMEK</text><polygon fill="#FF0000" points="467.0371,3699.1016,457.0371,3703.1016,467.0371,3707.1016,463.0371,3703.1016" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="3703.1016" y2="3703.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="3698.3594">[063]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="3698.3594">done</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1901.2163" x="5" y="3731.7568"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="3731.7568" y2="3731.7568"/><line style="stroke:#000000;stroke-width:1;" x1="5" x2="1906.2163" y1="3734.7568" y2="3734.7568"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="313.5142" x="798.8511" y="3721.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="295.2295" x="804.8511" y="3737.6699">Encrypt PMEK with unlocked Encryption Key</text><polygon fill="#FF0000" points="1065.3926,3802.3438,1075.3926,3806.3438,1065.3926,3810.3438,1069.3926,3806.3438" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="3806.3438" y2="3806.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="3786.291">[064]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.0884" x="502.3999" y="3770.9805">Wrap(Key: Slot B,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.5112" x="539.4194" y="3786.291">Data Key : Slot Z</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.9351" x="539.4194" y="3801.6016">Destination : unlocked_pmek)</text><polygon fill="#FF0000" points="1474.542,3831.6543,1484.542,3835.6543,1474.542,3839.6543,1478.542,3835.6543" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1480.542" y1="3835.6543" y2="3835.6543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3830.9121">[065]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.9868" x="1133.7554" y="3830.9121">Get Encryption Key</text><polygon fill="#FF0000" points="1809.2163,3860.9648,1819.2163,3864.9648,1809.2163,3868.9648,1813.2163,3864.9648" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1815.2163" y1="3864.9648" y2="3864.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3860.2227">[066]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59.5283" x="1133.7554" y="3860.2227">Get PMEK</text><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1129.3926" y1="3894.2754" y2="3894.2754"/><line style="stroke:#FF0000;stroke-width:1;" x1="1129.3926" x2="1129.3926" y1="3894.2754" y2="3907.2754"/><line style="stroke:#FF0000;stroke-width:1;" x1="1088.3926" x2="1129.3926" y1="3907.2754" y2="3907.2754"/><polygon fill="#FF0000" points="1098.3926,3903.2754,1088.3926,3907.2754,1098.3926,3911.2754,1094.3926,3907.2754" style="stroke:#FF0000;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="3889.5332">[067]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.2964" x="1133.7554" y="3889.5332">Encrypt slot Z using Slot B</text><polygon fill="#FF0000" points="467.0371,3932.5859,457.0371,3936.5859,467.0371,3940.5859,463.0371,3936.5859" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="3936.5859" y2="3936.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="3931.8438">[068]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.771" x="512.3999" y="3931.8438">Unocked PMEK</text><polygon fill="#FF0000" points="1065.3926,3977.207,1075.3926,3981.207,1065.3926,3985.207,1069.3926,3981.207" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="456.0371" x2="1071.3926" y1="3981.207" y2="3981.207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="463.0371" y="3968.8096">[069]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.9629" x="502.3999" y="3961.1543">Purge_key(Key: Slot Y,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.6675" x="568.2124" y="3976.4648">Key : Slot Z)</text><polygon fill="#FF0000" points="1702.4741,4006.5176,1712.4741,4010.5176,1702.4741,4014.5176,1706.4741,4010.5176" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1708.4741" y1="4010.5176" y2="4010.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="4005.7754">[070]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35.9214" x="1133.7554" y="4005.7754">Purge</text><polygon fill="#FF0000" points="1809.2163,4006.5176,1819.2163,4010.5176,1809.2163,4014.5176,1813.2163,4010.5176" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="1087.3926" x2="1815.2163" y1="4010.5176" y2="4010.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="1094.3926" y="4005.7754">[071]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1133.7554" y="4005.7754">&#160;</text><polygon fill="#FF0000" points="467.0371,4035.8281,457.0371,4039.8281,467.0371,4043.8281,463.0371,4039.8281" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="461.0371" x2="1076.3926" y1="4039.8281" y2="4039.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="473.0371" y="4035.0859">[072]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.478" x="512.3999" y="4035.0859">done</text><polygon fill="#FF0000" points="267.5845,4080.4492,257.5845,4084.4492,267.5845,4088.4492,263.5845,4084.4492" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;" x1="261.5845" x2="445.0371" y1="4084.4492" y2="4084.4492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="273.5845" y="4072.0518">[073]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.0898" x="312.9473" y="4064.3965">Command response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.9155" x="312.9473" y="4079.707">Unlocked_PMEK</text><line style="stroke:#008000;stroke-width:1;" x1="100.6826" x2="110.6826" y1="4084.4492" y2="4080.4492"/><line style="stroke:#008000;stroke-width:1;" x1="100.6826" x2="110.6826" y1="4084.4492" y2="4088.4492"/><line style="stroke:#008000;stroke-width:1;" x1="99.6826" x2="255.5845" y1="4084.4492" y2="4084.4492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35.3628" x="116.6826" y="4072.0518">[074]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.6826" x="156.0454" y="4064.3965">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.0684" x="156.0454" y="4079.707">complete</text><path d="M261.5845,4125.4492 L261.5845,4200.4492 L880.5845,4200.4492 L880.5845,4135.4492 L870.5845,4125.4492 L261.5845,4125.4492 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M870.5845,4125.4492 L870.5845,4135.4492 L880.5845,4135.4492 L870.5845,4125.4492 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="267.5845" y="4145.0176">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32.1509" x="271.6978" y="4145.0176">Field</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="375.0313" y="4145.0176">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="26.9521" x="379.1445" y="4145.0176">Size</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="479.7739" y="4145.0176">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66.644" x="483.8872" y="4145.0176">Definition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49.1563" x="271.6978" y="4160.3281">chksum</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24.5083" x="379.1445" y="4160.3281">u32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78.0254" x="483.8872" y="4160.3281">Little endian</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.0723" x="271.6978" y="4175.6387">fips_status</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24.5083" x="379.1445" y="4175.6387">u32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338.4253" x="483.8872" y="4175.6387">Indicates if the command is FIPS approved or an error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.2202" x="271.6978" y="4190.9492">unlocked_pmek</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.5161" x="379.1445" y="4190.9492">EncryptedPmek</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="377.6602" x="483.8872" y="4190.9492">PMEK encrypted to an export secret that is rotated  on reset</text><line style="stroke:#000000;stroke-width:0.5;" x1="267.5845" x2="865.6606" y1="4132.4492" y2="4132.4492"/><line style="stroke:#000000;stroke-width:0.5;" x1="267.5845" x2="865.6606" y1="4147.7598" y2="4147.7598"/><line style="stroke:#000000;stroke-width:0.5;" x1="267.5845" x2="865.6606" y1="4163.0703" y2="4163.0703"/><line style="stroke:#000000;stroke-width:0.5;" x1="267.5845" x2="865.6606" y1="4178.3809" y2="4178.3809"/><line style="stroke:#000000;stroke-width:0.5;" x1="267.5845" x2="865.6606" y1="4193.6914" y2="4193.6914"/><line style="stroke:#000000;stroke-width:0.5;" x1="267.5845" x2="267.5845" y1="4132.4492" y2="4193.6914"/><line style="stroke:#000000;stroke-width:0.5;" x1="375.0313" x2="375.0313" y1="4132.4492" y2="4193.6914"/><line style="stroke:#000000;stroke-width:0.5;" x1="479.7739" x2="479.7739" y1="4132.4492" y2="4193.6914"/><line style="stroke:#000000;stroke-width:0.5;" x1="865.6606" x2="865.6606" y1="4132.4492" y2="4193.6914"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="135.7324" x="944.2419" y="4299.8242">Filename: unlock_pmek.uml</text><!--SRC=[tLfHRzf847xdLqnGTO8hv4BIddfHqnE5f8behoWaFRMAX1Px0GjxRUqk95JvyJUpDdXj38KgQQBp2yQUdPsTxvlPyUxkUSBnfow7q8dwVkXC-bFj-MeV7vTAfJrl29KNQXpUzhMdVLuj0LvNT0lbQq7oqFrqsYcNzhXmlM6cHIIv4metRYD2pO4vCbJA_AVhxU1TDvRnj1SATVpsZy6xvTlVeUauN2deZPdaBlIu8xa6valEt3cm6VFy0ThX2M2W_53JNUUBrNvg3FJ422PylcoOoZFXmeWBBfb6_Q40pfmnIAwuJcqSXaA34_gXF44htbqeq6CkEUdW4QEcEGCZBg7f1jZDjUBoxxT_a8PuMEWZuuYbjvISl7m9BzvVdvsTNlQRhQkBByshYy__b2Oy61M_YG8-KSMlIiDRUC7KN3WG353a6Ax_-VYvrUaJH1beMEHPi4XlDDROP3deUuBcpEE-2zPbdlQyxpptgCs7dZ08mhsbmXbFr3G0oAgO7Xtc7ttqDF69NCAoAcubYoBkzfaXGfzGnAV_nazZTdJmsJrqJZ_L4s68XGdo6_4x_WJzCGBjS_n7VvW_2gMdnq7ot_4Yn5FpEqtYN3Xo7kbydvPDH2byJJ1OOpXTjEicp-zDNAJwG8UWT2ZP2FqT8laC9OLjRjBD2ac2mG9LPtXhO6s5GO1jCv06QjH7FYgaUmojGsn8o81jFd2YSToENWU3UjtSl53S7rRAA5wkGRdDDPT8NhuGBbVH45_nj55YLweVxuuXRMXY8XocuLSgCLz3Bndz9OsUOEDtdj9nDg3tryjeDGe6t0zlCTOm7CUXZsDTEFlan8m5et2H84ZPoSbIW9GHifuB9t1mTt3GQ42bVOuSgNJhHszUrU2yqpwhzywR-ATQBTbiJ0SrcRryUGodhVPv1Lj2btaIlPZI2IeVghKROJSckPHEYRJDBrkupPNs13DXSmm13q8vpzeocIrCmMGG0qWzu6WZD6QDw2ossKYsKbjkaV6RMneGkrCDs1XzFlLrHivYcXiAdhKqhwXUno6HM5R5aaRPTWaFKx6OzfjXQVNH7ztf0CUq7f-7ycSBN2wz6OTeEl0zKZ3_WHF93XH-HYwqCZsgNz5nXU4aY2bAyqXHy7COoZ20oxCM_DLuSr33-SunR7srtwWXVHqMmN0gpBECkcK2opp5i6t7JZplTauXKdpgXdM9M64dbFq2Z7hfCHygtSjEbG9w8mNEFpLR6ByL2lvZu46avxbmp5marcQQeMoP3AZF6cLCqcLa0FqkqaISDwfmVoFAiEt56STYPq9wbi6pmHGxydjOXnp3r-fwzYNZX32YEYNlwwMeHW_CK-dO241FPiIDL77ny7oOccEAYgih5LTNkz62t0jVD_4YuGJXVtG0bO4tgYU5oAitLIB82basA4kl5Jv1EHv7Fnu7gSlE3lXWAyr9PeavYptGN0O3KucBQJ3WileWr4luH4dIe91dKY57JLNzDPviN7JiBbJDmFoqRBGIMUbdgueQJDnXAdnm62ErU5y3XXyZsVVDqrxzyFMVzG-jJzN7ITqANkytJDNvUl-mHZcnvuovE_NvUwQuUT72ZnNKTRd_EU9YcTyLeHIHaXdtvp-JxISuLfoPrTZqGfMm-NABwvw7JlP5YPxk2pFzqlynODLj0t7HB07InBWrJjDf6IeYX6wl0nVjRUFoHyNWzdE2gKPoOMPP-7nJlYU6uV-VBCjHcYwvO0EV9v-TvUsuyhXKMThtZ6k3P4t8PaddIpmFFLAbyEjvabOCQJvvd4b-_HpyyDFzCvZdDp5hW1DYNuJ2uG-GWtOgGmzQcJAqSRXIXgvdtKuSIwbPnBhK0ULT56EPG-uBGfUJ6dlYlqypoeEajnNsFYXjYp9YwfDrzTbaLbYUMMpo56Y9PHLB5WKRXp2OQwwAYwfd6n-BvSjVbNQ9MuVP3xIZ9ueC7FgJXSIk2VqNPFByOjYFeu6uam-3eoGCO1XAcDB7Y49-WVLDjDBHSmqIi-9lh-lduwItJPnO8zyKAnTVy4sQNd9lM_PgTD7UXhK0aMjwnKRhscWsoWatcsqgZSgrJMlSnlvlMp9txH8hqTPcXRlYx_KTV8yNPzU86ebdk3XMk1o1J6j9JXibj16IR3-HdvFDaDAc_FkwSTWdD9JDhEOFix0b_ErdqzNIEKfEOhZp-qAbTT2HSBhZKrgRq71qoOZYX1ORNDgKpgZ9OicKzagtmdeppgiOP_3DPm_4y_HEI-R45iIMxm3hjQ3zpqsPWY0yjhSlDyNgIh0M1MhMl6905kdGwdSjm4_e-dWabklZpKkSctR0uDy4WGI0zpO0cm8ew_f5pyPN1G2O0m3R0M05JiQtsUsjPEoc1lY6SozjmSO3-4amhaNikYoUku6IzsrtAaUSPX_BmKLre-tYTUo5lJr8D2ubVijv3MMUW8gvFVjadzyileP2yHjnlI17nhU_GNf687j4u4OuOH3vFAcIQ0hXkOC3Evu5oPy2sVu8IFxmnwQJ7qClKdsbcPwgmfONs8HgHmKu49e1azCAL5UUNNHxmA98XZCwrYEfZkHIuetTGoRCLavm51tV83LtKIWNYnVOBzFKeGorAMFf294vFRJc98TXIEa_]--></g></svg>