<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="876px" preserveAspectRatio="none" style="width:659px;height:876px;background:#FFFFFF;" version="1.1" viewBox="0 0 659 876" width="659px" zoomAndPan="magnify"><defs><filter height="300%" id="f3sd8vspwcx0t" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="798.875" style="stroke:#A80036;stroke-width:1.0;" width="401" x="226.5" y="55.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="369.5" y="68.7139">Encryption Engine</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="44" x="608.5" y="15.3809">Version 1</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="442" x="117.25" y="43.2637">Load MEK into the Key Cache of the Encryption Engine</text><rect fill="#FFFFFF" filter="url(#f3sd8vspwcx0t)" height="119.4063" style="stroke:#000000;stroke-width:2.0;" width="311.5" x="8" y="323.8984"/><rect fill="#FFFFFF" filter="url(#f3sd8vspwcx0t)" height="119.4063" style="stroke:#000000;stroke-width:2.0;" width="230" x="251" y="540.7109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="267" x2="267" y1="129.7891" y2="793.875"/><rect fill="#FFFFFF" filter="url(#f3sd8vspwcx0t)" height="414.2734" style="stroke:#A80036;stroke-width:1.0;" width="10" x="262" y="374.6016"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="465" x2="465" y1="129.7891" y2="793.875"/><rect fill="#FFFFFF" filter="url(#f3sd8vspwcx0t)" height="63.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="460" y="204.4922"/><rect fill="#FFFFFF" filter="url(#f3sd8vspwcx0t)" height="296.2188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="460" y="479.6563"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="580" x2="580" y1="129.7891" y2="793.875"/><rect fill="#FEFECE" filter="url(#f3sd8vspwcx0t)" height="49.2188" style="stroke:#A80036;stroke-width:1.5;" width="69" x="230.5" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="251" y="97.1035">SFR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="237.5" y="114.7129">Interface</text><rect fill="#FEFECE" filter="url(#f3sd8vspwcx0t)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="60" x="433" y="93.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="440" y="114.7129">Control</text><rect fill="#FEFECE" filter="url(#f3sd8vspwcx0t)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="83" x="536.5" y="93.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="543.5" y="114.7129">Key Cache</text><rect fill="#FEFECE" filter="url(#f3sd8vspwcx0t)" height="49.2188" style="stroke:#A80036;stroke-width:1.5;" width="69" x="230.5" y="793.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="251" y="815.4082">SFR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="237.5" y="833.0176">Interface</text><rect fill="#FEFECE" filter="url(#f3sd8vspwcx0t)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="60" x="433" y="793.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="440" y="815.4082">Control</text><rect fill="#FEFECE" filter="url(#f3sd8vspwcx0t)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="83" x="536.5" y="793.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="543.5" y="815.4082">Key Cache</text><rect fill="#EEEEEE" filter="url(#f3sd8vspwcx0t)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="628.5" x="5" y="158.9648"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="633.5" y1="158.9648" y2="158.9648"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="633.5" y1="161.9648" y2="161.9648"/><rect fill="#EEEEEE" filter="url(#f3sd8vspwcx0t)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="200" x="219.25" y="147.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="182" x="225.25" y="165.2842">Prepare for a new command</text><polygon fill="#FF0000" points="255,200.4922,265,204.4922,255,208.4922,259,204.4922" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="5" x2="261" y1="204.4922" y2="204.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="12" y="199.6357">[001]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="45" y="199.6357">Write Control Reg(DONE == 1b)</text><line style="stroke:#008000;stroke-width:1.0;" x1="458" x2="448" y1="204.4922" y2="200.4922"/><line style="stroke:#008000;stroke-width:1.0;" x1="458" x2="448" y1="204.4922" y2="208.4922"/><line style="stroke:#008000;stroke-width:1.0;" x1="267" x2="459" y1="204.4922" y2="204.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="274" y="199.6357">[002]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="311" y="199.6357"/><polygon fill="#FF0000" points="278,263.5469,268,267.5469,278,271.5469,274,267.5469" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="272" x2="459" y1="267.5469" y2="267.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="284" y="246.3389">[003]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="317" y="229.9873">Write Control Reg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="321" y="246.3389">Done = 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="321" y="262.6904">EXE = 0, ERROR = 0h</text><rect fill="#EEEEEE" filter="url(#f3sd8vspwcx0t)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="628.5" x="5" y="296.7227"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="633.5" y1="296.7227" y2="296.7227"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="633.5" y1="299.7227" y2="299.7227"/><rect fill="#EEEEEE" filter="url(#f3sd8vspwcx0t)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="148" x="245.25" y="285.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="251.25" y="303.042">Execute a command</text><path d="M8,323.8984 L130,323.8984 L130,331.8984 L120,341.8984 L8,341.8984 L8,323.8984 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="119.4063" style="stroke:#000000;stroke-width:2.0;" width="311.5" x="8" y="323.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="23" y="338.3936">in any order</text><polygon fill="#FF0000" points="250,370.6016,260,374.6016,250,378.6016,254,374.6016" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="5" x2="256" y1="374.6016" y2="374.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="12" y="369.7451">[004]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="45" y="369.7451">MEK</text><polygon fill="#FF0000" points="250,400.9531,260,404.9531,250,408.9531,254,404.9531" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="5" x2="256" y1="404.9531" y2="404.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="12" y="400.0967">[005]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="45" y="400.0967">Write Aux</text><polygon fill="#FF0000" points="250,431.3047,260,435.3047,250,439.3047,254,435.3047" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="5" x2="256" y1="435.3047" y2="435.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="12" y="430.4482">[006]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="45" y="430.4482">Write Metadata</text><polygon fill="#FF0000" points="250,524.7109,260,528.7109,250,532.7109,254,528.7109" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="5" x2="256" y1="528.7109" y2="528.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="12" y="499.3271">[007]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="45" y="474.7998">Write Control Reg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="45" y="491.1514">(EXE = Load_MEK,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="49" y="507.5029">DONE = 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="49" y="523.8545">EXE = 1)</text><line style="stroke:#008000;stroke-width:1.0;" x1="458" x2="448" y1="528.7109" y2="524.7109"/><line style="stroke:#008000;stroke-width:1.0;" x1="458" x2="448" y1="528.7109" y2="532.7109"/><line style="stroke:#008000;stroke-width:1.0;" x1="272" x2="459" y1="528.7109" y2="528.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="279" y="523.8545">[008]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="316" y="523.8545"/><path d="M251,540.7109 L368,540.7109 L368,548.7109 L358,558.7109 L251,558.7109 L251,540.7109 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="119.4063" style="stroke:#000000;stroke-width:2.0;" width="230" x="251" y="540.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="266" y="555.2061">in any oder</text><polygon fill="#FF0000" points="283,587.4141,273,591.4141,283,595.4141,279,591.4141" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="277" x2="459" y1="591.4141" y2="591.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="289" y="586.5576">[009]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="322" y="586.5576">Read MEK</text><polygon fill="#FF0000" points="283,617.7656,273,621.7656,283,625.7656,279,621.7656" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="277" x2="459" y1="621.7656" y2="621.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="289" y="616.9092">[010]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="322" y="616.9092">Read AUX</text><polygon fill="#FF0000" points="283,648.1172,273,652.1172,283,656.1172,279,652.1172" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="277" x2="459" y1="652.1172" y2="652.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="289" y="647.2607">[011]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="322" y="647.2607">Read Metadata</text><polygon fill="#FF0000" points="568,692.4688,578,696.4688,568,700.4688,572,696.4688" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="470" x2="574" y1="696.4688" y2="696.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="477" y="691.6123">[012]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="510" y="691.6123">Store Key</text><polygon fill="#FF0000" points="283,771.875,273,775.875,283,779.875,279,775.875" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="277" x2="459" y1="775.875" y2="775.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="289" y="746.4912">[013]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="322" y="721.9639">Write Control Reg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="322" y="738.3154">(Done = 1b,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="326" y="754.667">Error = 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="326" y="771.0186">EXE = 0)</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="163" x="256.75" y="868.4746">Filename: load_mek_into _ee.uml</text><!--MD5=[19c111bf88e2ab961f38179c9286ac3a]
@startuml

!include ocp_lock_utils.inc

!if ($show_title)
    Title "Load MEK into the Key Cache of the Encryption Engine"
!endif

== Prepare for a new command ==

[$sync sfr : Write Control Reg(DONE == 1b)
& sfr $async ee++

ee $sync sfr- - : Write Control Reg\n Done = 0,\n EXE = 0, ERROR = 0h

== Execute a command ==

group in any order
    [$sync sfr++ : MEK
    [$sync sfr : Write Aux
    [$sync sfr : Write Metadata
end
[$sync sfr : Write Control Reg\n(EXE = Load_MEK,\n DONE = 0,\n EXE = 1)
& sfr $async ee++

group in any oder
    ee $sync sfr : Read MEK
    ee $sync sfr : Read AUX
    ee $sync sfr : Read Metadata
end

ee $sync kc : Store Key

ee $sync sfr- - : Write Control Reg\n(Done = 1b,\n Error = 0,\n EXE = 0)
sfr- -

@enduml

@startuml









	autonumber 1 1  "<b>[000]"

	!pragma teoz true

    participant "Remote Key\nManagement Service" as rkms


    participant "Host" as host


    participant "Storage\nDevice\nFW" as fw

    box "Caliptra"
    	participant "Mail Box" as mb
    	participant "ROM" as crom
    	participant "FW" as cfw
    	participant "ROM to FW\nHandoff Data" as hoff
        participant "DRBG" as rand
        participant "DMA Engine" as dma
        participant "Key Vault" as kv
        participant "Key Vault\nFuses" as fuses
        participant "Key Vault\nStorage Root Key" as gsrk
        participant "Key Vault\nSlot A\n(Storage Root Key)" as srk
        participant "Key Vault\nSlot B\n(PMEK Secret)" as pmeks
        participant "Key Vault\nSlot F\n(DICE Alias Key)\necdsa_secp384r1_sha384" as dice
        participant "Key Vault\nSlot G\n(KEM Keypair)" as kemg
        participant "Key Vault\nSlot W\n(Temporary)" as tempw
        participant "Key Vault\nSlot X\n(MEK Seed)" as meks
        participant "Key Vault\nSlot Y\n(Temporary)" as tempy
        participant "Key Vault\nSlot Z\n(Temporary)" as tempz
        participant "Key Vault\nTemp Memory" as tempmem
    end box

    box "Encryption Engine"
        participant "SFR\nInterface" as sfr
        participant "Control" as ee
        participant "Key Cache" as kc
    end box

    box "Media"
        participant "Create new\Storage Root Key\non NVM subsystem reset" as csrk
        participant "Destroy all\Storage Root Keys\non NVM subsystem reset" as dsrk
    end box

    hide unlinked
	footer Filename: load_mek_into _ee.uml

	header Version 1


    Title "Load MEK into the Key Cache of the Encryption Engine"

== Prepare for a new command ==

[-[#red]> sfr : Write Control Reg(DONE == 1b)
& sfr -[#green]>> ee++

ee -[#red]> sfr- - : Write Control Reg\n Done = 0,\n EXE = 0, ERROR = 0h

== Execute a command ==

group in any order
    [-[#red]> sfr++ : MEK
    [-[#red]> sfr : Write Aux
    [-[#red]> sfr : Write Metadata
end
[-[#red]> sfr : Write Control Reg\n(EXE = Load_MEK,\n DONE = 0,\n EXE = 1)
& sfr -[#green]>> ee++

group in any oder
    ee -[#red]> sfr : Read MEK
    ee -[#red]> sfr : Read AUX
    ee -[#red]> sfr : Read Metadata
end

ee -[#red]> kc : Store Key

ee -[#red]> sfr- - : Write Control Reg\n(Done = 1b,\n Error = 0,\n EXE = 0)
sfr- -

@enduml

PlantUML version 1.2021.7(Sun May 23 06:40:07 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>