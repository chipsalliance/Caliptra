<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="513px" preserveAspectRatio="none" style="width:778px;height:513px;background:#FFFFFF;" version="1.1" viewBox="0 0 778 513" width="778px" zoomAndPan="magnify"><defs><filter height="300%" id="f5y0eflm87xlz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="435.8203" style="stroke:#A80036;stroke-width:1.0;" width="241" x="247" y="55.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="342.5" y="68.7139">Caliptra</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="44" x="727" y="15.3809">Version 1</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="202" x="287" y="43.2637">Enumerate KEM Handles</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="39" x2="39" y1="147.3984" y2="413.2109"/><rect fill="#FFFFFF" filter="url(#f5y0eflm87xlz)" height="18" style="stroke:#A80036;stroke-width:1.0;" width="10" x="34" y="395.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="286" x2="286" y1="147.3984" y2="413.2109"/><rect fill="#FFFFFF" filter="url(#f5y0eflm87xlz)" height="43.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="281" y="234.4531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="464" x2="464" y1="147.3984" y2="413.2109"/><rect fill="#FFFFFF" filter="url(#f5y0eflm87xlz)" height="143.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459" y="264.8047"/><rect fill="#FEFECE" filter="url(#f5y0eflm87xlz)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="64" x="5" y="75.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="12" y="97.1035">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="15.5" y="114.7129">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="26" y="132.3223">FW</text><rect fill="#FEFECE" filter="url(#f5y0eflm87xlz)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="66" x="251" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="258" y="132.3223">Mail Box</text><rect fill="#FEFECE" filter="url(#f5y0eflm87xlz)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="36" x="444" y="110.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="451" y="132.3223">FW</text><rect fill="#FEFECE" filter="url(#f5y0eflm87xlz)" height="66.8281" style="stroke:#A80036;stroke-width:1.5;" width="64" x="5" y="413.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="12" y="434.7441">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="15.5" y="452.3535">Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="26" y="469.9629">FW</text><rect fill="#FEFECE" filter="url(#f5y0eflm87xlz)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="66" x="251" y="413.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="258" y="434.7441">Mail Box</text><rect fill="#FEFECE" filter="url(#f5y0eflm87xlz)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="36" x="444" y="413.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="451" y="434.7441">FW</text><path d="M17,160.3984 L17,202.3984 L486,202.3984 L486,170.3984 L476,160.3984 L17,160.3984 " fill="#FBFB77" filter="url(#f5y0eflm87xlz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M476,160.3984 L476,170.3984 L486,170.3984 L476,160.3984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91" x="68.5" y="178.8936">Preconditions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345" x="76.5" y="195.2451">* Caliptra FW manages which keys are in which slots in KV</text><line style="stroke:#008000;stroke-width:1.0;" x1="279" x2="269" y1="234.4531" y2="230.4531"/><line style="stroke:#008000;stroke-width:1.0;" x1="279" x2="269" y1="234.4531" y2="238.4531"/><line style="stroke:#008000;stroke-width:1.0;" x1="39" x2="280" y1="234.4531" y2="234.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="46" y="229.5967">[001]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="79" y="229.5967">ENUMERATE_KEM_HANDLES</text><line style="stroke:#008000;stroke-width:1.0;" x1="457" x2="447" y1="264.8047" y2="260.8047"/><line style="stroke:#008000;stroke-width:1.0;" x1="457" x2="447" y1="264.8047" y2="268.8047"/><line style="stroke:#008000;stroke-width:1.0;" x1="291" x2="458" y1="264.8047" y2="264.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="298" y="259.9482">[002]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="331" y="259.9482">Message</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="469" x2="511" y1="295.1563" y2="295.1563"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="511" x2="511" y1="295.1563" y2="308.1563"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="470" x2="511" y1="308.1563" y2="308.1563"/><polygon fill="#FF0000" points="480,304.1563,470,308.1563,480,312.1563,476,308.1563" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="476" y="290.2998">[003]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="509" y="290.2998">Create list of valid KEM handles</text><path d="M474,321.1563 L474,347.1563 L762,347.1563 L762,331.1563 L752,321.1563 L474,321.1563 " fill="#FBFB77" filter="url(#f5y0eflm87xlz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M752,321.1563 L752,331.1563 L762,331.1563 L752,321.1563 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267" x="480" y="339.6514">One handle for each KEM algorithm supported</text><polygon fill="#FF0000" points="297,391.2109,287,395.2109,297,399.2109,293,395.2109" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="291" x2="458" y1="395.2109" y2="395.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="303" y="382.1787">[004]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="336" y="374.0029">Command response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="336" y="390.3545">kem_handles</text><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="54" y1="395.2109" y2="391.2109"/><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="54" y1="395.2109" y2="399.2109"/><line style="stroke:#008000;stroke-width:1.0;" x1="44" x2="285" y1="395.2109" y2="395.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="61" y="382.1787">[005]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="94" y="374.0029">Command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="94" y="390.3545">complete</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="191" x="292.5" y="505.4199">Filename: enumerate_kem_handles.uml</text><!--MD5=[9b9a8379c027d4ea97aaba234fcdbca4]
@startuml

!include ocp_lock_utils.inc

!if ($show_title)
    Title "Enumerate KEM Handles"
!endif

!if ($show_precond)
    note across
        <b>Preconditions:</b>
          * Caliptra FW manages which keys are in which slots in KV
    end note
!endif

fw $async mb++ : ENUMERATE_KEM_HANDLES

!if ($show_api)
    note over mb
        | <b>Field | <b>Size | <b>Definition |
        | chksum   | u32     | Little endian |
    end note
!endif

mb $async cfw++ : Message



!if ($show_msg_parsing)
    cfw $sync mb : Get message
    mb- -
    $self("cfw", "Determine message")
!else
    mb- -
!endif


cfw $sync cfw: Create list of valid KEM handles
note right cfw
    One handle for each KEM algorithm supported
end note

cfw $sync mb : Command response\nkem_handles
& mb $async fw++ : Command\ncomplete


!if ($show_api)
    note right mb
        | <b>Field         | <b>Size      | <b>Definition |
        | chksum           | u32          | Little endian |
        | fips_status      | u32          | Indicates if the command is FIPS approved or an error |
        | kem_handle_count | u32          | Number of KEM handles (N) |
        | kem_handles      | KEMHandle[N] | List of (KEM handle value, KEM algorithm) tuples |
    end note
!endif
cfw- -





@enduml

@startuml









	autonumber 1 1  "<b>[000]"

	!pragma teoz true

    participant "Remote Key\nManagement Service" as rkms


    participant "Host" as host


    participant "Storage\nDevice\nFW" as fw

    box "Caliptra"
    	participant "Mail Box" as mb
    	participant "ROM" as crom
    	participant "FW" as cfw
    	participant "ROM to FW\nHandoff Data" as hoff
        participant "DRBG" as rand
        participant "DMA Engine" as dma
        participant "Key Vault" as kv
        participant "Key Vault\nFuses" as fuses
        participant "Key Vault\nStorage Root Key" as gsrk
        participant "Key Vault\nSlot A\n(Storage Root Key)" as srk
        participant "Key Vault\nSlot B\n(PMEK Secret)" as pmeks
        participant "Key Vault\nSlot F\n(DICE Alias Key)\necdsa_secp384r1_sha384" as dice
        participant "Key Vault\nSlot G\n(KEM Keypair)" as kemg
        participant "Key Vault\nSlot W\n(Temporary)" as tempw
        participant "Key Vault\nSlot X\n(MEK Seed)" as meks
        participant "Key Vault\nSlot Y\n(Temporary)" as tempy
        participant "Key Vault\nSlot Z\n(Temporary)" as tempz
        participant "Key Vault\nTemp Memory" as tempmem
    end box

    box "Encryption Engine"
        participant "SFR\nInterface" as sfr
        participant "Control" as ee
        participant "Key Cache" as kc
    end box

    box "Media"
        participant "Create new\Storage Root Key\non NVM subsystem reset" as csrk
        participant "Destroy all\Storage Root Keys\non NVM subsystem reset" as dsrk
    end box

    hide unlinked
	footer Filename: enumerate_kem_handles.uml

	header Version 1


    Title "Enumerate KEM Handles"

    note across
        <b>Preconditions:</b>
          * Caliptra FW manages which keys are in which slots in KV
    end note

fw -[#green]>> mb++ : ENUMERATE_KEM_HANDLES


mb -[#green]>> cfw++ : Message



    mb- -


cfw -[#red]> cfw: Create list of valid KEM handles
note right cfw
    One handle for each KEM algorithm supported
end note

cfw -[#red]> mb : Command response\nkem_handles
& mb -[#green]>> fw++ : Command\ncomplete


cfw- -





@enduml

PlantUML version 1.2021.7(Sun May 23 06:40:07 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>